<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ë”±ë§ˆë¦¬ì¹˜í‚¨ | ìŠ¤ì¼€ì¼ì—… ì‹œë®¬ë ˆì´í„°</title>
<style>
  :root{
    /* Dim palette (high contrast) */
    --bg:#0b1118;           /* page background */
    --panel:#0f1725;        /* section/card background */
    --ink:#e6edf3;          /* primary text */
    --muted:#a9bbcf;        /* secondary text */
    --line:#1e2b3c;         /* borders */
    --chip:#0c1420;         /* chip background */
    --radius:14px;
    /* Section key colors */
    --sky:#38bdf8;          /* ê²°ë¡  */
    --skyL:#7dd3fc;         /* ì˜ˆì‚° */
    --green:#22c55e;        /* OPEX */
    --indigo:#818cf8;       /* Flow */
    --purple:#a78bfa;       /* ROI & P&L */
    --teal:#2dd4bf;         /* Center */
    --rose:#fb7185;         /* Compliance */
    --amber:#f59e0b;        /* Roadmap */
    --slate:#94a3b8;        /* Decision */
  }
  *{box-sizing:border-box}
  html,body{margin:0;background:var(--bg);color:var(--ink);
    font-family:-apple-system,BlinkMacSystemFont,'Apple SD Gothic Neo','Malgun Gothic','Segoe UI',Roboto,Arial,'Noto Sans KR',sans-serif}
  .wrap{max-width:1100px;margin:28px auto 60px;padding:0 20px}
  header{display:flex;align-items:flex-end;gap:16px;flex-wrap:wrap;margin-bottom:12px}
  h1{font-size:28px;margin:0}
  .sub{color:var(--muted);font-size:14px}
  .tag{display:inline-block;padding:4px 10px;border:1px solid var(--line);border-radius:999px;font-size:12px;color:var(--ink);background:#0d1624}
  nav{position:sticky;top:0;z-index:10;background:rgba(11,17,24,.86);backdrop-filter:blur(6px);
      display:flex;flex-wrap:wrap;gap:8px;margin:12px 0 20px;border:1px solid var(--line);
      border-radius:999px;padding:8px}
  nav a{padding:8px 12px;border-radius:999px;border:1px solid var(--line);text-decoration:none;color:var(--muted);font-size:13px;background:#0d1624}
  nav a:hover{border-color:#314358;color:#ffffff}
  section{background:var(--panel);border:1px solid var(--line);border-radius:var(--radius);padding:16px;margin-bottom:16px;
          box-shadow:0 12px 30px rgba(0,0,0,.25)}
  section h2{margin:0 0 10px;font-size:20px}
  .secbar{height:7px;border-radius:999px;margin:-7px 0 12px}
  /* Section tints */
  .tint:before{content:"";position:absolute;inset:0;pointer-events:none;opacity:.10}
  .sec-sky.tint:before{background:linear-gradient(180deg, rgba(56,189,248,.25), transparent 160px)}
  .sec-skyL.tint:before{background:linear-gradient(180deg, rgba(125,211,252,.22), transparent 160px)}
  .sec-green.tint:before{background:linear-gradient(180deg, rgba(34,197,94,.22), transparent 160px)}
  .sec-indigo.tint:before{background:linear-gradient(180deg, rgba(129,140,248,.22), transparent 160px)}
  .sec-purple.tint:before{background:linear-gradient(180deg, rgba(167,139,250,.22), transparent 160px)}
  .sec-teal.tint:before{background:linear-gradient(180deg, rgba(45,212,191,.22), transparent 160px)}
  .sec-rose.tint:before{background:linear-gradient(180deg, rgba(251,113,133,.22), transparent 160px)}
  .sec-amber.tint:before{background:linear-gradient(180deg, rgba(245,158,11,.22), transparent 160px)}
  .sec-slate.tint:before{background:linear-gradient(180deg, rgba(148,163,184,.22), transparent 160px)}
  .sec-sky .secbar{background:linear-gradient(90deg,var(--sky),#7dd3fc)}
  .sec-skyL .secbar{background:linear-gradient(90deg,var(--skyL),#bde5fc)}
  .sec-green .secbar{background:linear-gradient(90deg,var(--green),#86efac)}
  .sec-indigo .secbar{background:linear-gradient(90deg,var(--indigo),#a5b4fc)}
  .sec-purple .secbar{background:linear-gradient(90deg,var(--purple),#c4b5fd)}
  .sec-teal .secbar{background:linear-gradient(90deg,var(--teal),#5eead4)}
  .sec-rose .secbar{background:linear-gradient(90deg,var(--rose),#fecdd3)}
  .sec-amber .secbar{background:linear-gradient(90deg,var(--amber),#fcd34d)}
  .sec-slate .secbar{background:linear-gradient(90deg,var(--slate),#cbd5e1)}
  .accentL{border-left:6px solid rgba(255,255,255,.06);padding-left:10px}
  /* Common UI */
  .grid{display:grid;gap:12px}
  .g-2{grid-template-columns:repeat(2,1fr)}
  .g-3{grid-template-columns:repeat(3,1fr)}
  .card{border:1px solid var(--line);border-radius:12px;padding:14px;background:#0f1b2c}
  .lead{font-size:18px;font-weight:800}
  .k{font-size:12px;color:var(--muted)}
  .v{font-size:24px;font-weight:900;color:#ffffff}
  .chip{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;border:1px solid var(--line);font-size:12px;background:var(--chip);color:var(--ink)}
  .chip.clickable {
    border-color: var(--sky);
    color: var(--skyL);
    cursor: pointer;
    transition: background-color 0.2s, color 0.2s;
  }
  .chip.clickable:hover {
    background-color: var(--sky);
    color: var(--bg);
  }
  .chip.clickable:hover b {
    color: var(--bg);
  }
  .note{margin-top:10px;color:var(--muted);font-size:12px;border-top:1px dashed var(--line);padding-top:10px}
  table{width:100%;border-collapse:collapse;font-size:14px}
  th,td{border-bottom:1px solid var(--line);padding:10px;text-align:right}
  th:first-child,td:first-child{text-align:left}
  thead th{background:#0d1624}
  tbody tr:nth-child(even){background:#101b2b}   /* zebra */
  tbody tr:hover td{background:#112235}         /* hover */

  label{font-size:12px;color:var(--muted);display:block;margin-bottom:4px}
  /* PNL ì…ë ¥ê°’ ë³€ê²½ ì‹œ ROIì™€ ë™ê¸°í™” ë° ì¦‰ì‹œ ê³„ì‚°ì´ ì¼ì–´ë‚˜ë„ë¡ oninput ì¶”ê°€ */
  input[type="text"],input[type="number"],input[type="password"]{width:100%;background:#0d1624;color:#e6edf3;border:1px solid var(--line);border-radius:10px;padding:8px 10px;font-size:14px; transition: all 0.3s;}
  input:read-only { background: #0a1018; color: var(--muted); cursor: default; }
  .btn{display:inline-block;background:linear-gradient(90deg,#38bdf8,#60a5fa);color:#001018;font-weight:800;border:none;padding:9px 12px;border-radius:10px;cursor:pointer}
  .btn:disabled { background: var(--slate); color: var(--muted); cursor: not-allowed; }
  .row{display:flex;justify-content:space-between;align-items:center;margin:6px 0}
  .pill{display:inline-block;padding:2px 8px;border-radius:999px;border:1px solid var(--line);font-size:11px;background:#0d1624;color:#d1e0ee}
  .kpiBar{display:flex;gap:8px;flex-wrap:wrap}
  .kpiBar .chip {
    font-size: 14px;
    padding: 8px 12px;
  }
  .kpiBar .chip > span, .kpiBar .chip > b:last-of-type {
    font-weight: 900;
    font-size: 1.1em;
    color: #fff;
    white-space: nowrap;
  }
  .kpiBar .chip b{color:#fff}

  .legend-rows{display:grid;grid-template-columns:1fr auto;gap:8px 14px;align-items:center;min-width:300px}
  .dot{width:10px;height:10px;border-radius:50%}
  canvas{width:230px;height:230px;max-width:100%}

  /* Modal Styles */
  .modal-backdrop { position: fixed; inset: 0; background: rgba(0,0,0,.6); backdrop-filter: blur(4px); z-index: 100; display: none; }
  .modal-content { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: var(--panel); border: 1px solid var(--line); border-radius: var(--radius); padding: 20px; width: 90%; max-width: 600px; max-height: 80vh; overflow-y: auto; box-shadow: 0 20px 40px rgba(0,0,0,.3); z-index: 101; }
  .modal-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--line); padding-bottom: 10px; margin-bottom: 15px; }
  .modal-header h3 { margin: 0; font-size: 18px; }
  .modal-close { background: none; border: none; font-size: 24px; color: var(--muted); cursor: pointer; }
  .modal-body ul { padding-left: 20px; margin: 0; }
  .modal-body li { margin-bottom: 8px; }
  .modal-body h4 { margin: 15px 0 8px; font-size: 16px; border-bottom: 1px dashed var(--line); padding-bottom: 5px; }
  .modal-body .total-row { font-weight: bold; border-top: 1px solid var(--line); padding-top: 10px; margin-top: 10px; }
  .modal-body #ai_equipment_recommendation_btn {
      width: 100%;
      margin-bottom: 15px;
      background: linear-gradient(90deg, var(--teal), var(--sky));
  }
  #ai_recommendation_results {
      margin-top: 20px;
      padding-top: 15px;
      border-top: 1px dashed var(--line);
  }
  #ai_recommendation_results h4 {
      margin-top: 0;
  }
  #ai_recommendation_results table {
      font-size: 13px;
  }
  #ai_recommendation_results a {
      color: var(--skyL);
      text-decoration: none;
  }
  #ai_recommendation_results a:hover {
      text-decoration: underline;
  }
  
  /* Simulator Section Specific Font Sizes */
  #simulator label[for="store_slider"] { font-size: 14px; }
  #slider_val_display { font-size: 16px; }
  #simulator .note { font-size: 13px; }
  #ai_params { font-size: 14px; padding: 10px 14px; }
  #simulator .lead { font-size: 20px; }
  
  .force-level-controls { display: flex; align-items: center; gap: 6px; font-size: 12px; }
  .pill-btn { background: var(--chip); border: 1px solid var(--line); color: var(--muted); border-radius: 999px; padding: 4px 10px; font-size: 12px; cursor: pointer; transition: all 0.2s; }
  .pill-btn:hover { border-color: #314358; color: #fff; }
  .pill-btn.active { background: var(--sky); color: var(--bg); border-color: var(--sky); font-weight: bold; }
  
  /* AI Applied Highlight Styles */
  .ai-applied {
    background-color: #103c2b !important;
    border-color: #22c55e !important;
    box-shadow: 0 0 10px rgba(34, 197, 94, 0.4);
  }
  .ai-applied-text {
    transition: color 0.4s ease-in-out;
    color: var(--green) !important;
    font-weight: bold;
  }
  .default-value-display {
    font-size: 11px;
    color: var(--muted);
    margin-left: 6px;
    font-style: italic;
    white-space: nowrap;
  }
  .ai-reasoning-note {
    display: block;
    font-size: 11px;
    color: var(--green);
    opacity: 0.8;
    margin-top: 4px;
    font-style: italic;
    padding-left: 2px;
  }
  
  @media (max-width:900px){ .g-2,.g-3{grid-template-columns:1fr} nav{position:static} }
</style>
<link rel="stylesheet" href="/index.css">
</head>
<body>
<div class="wrap">
  <header>
    <div>
      <h1>ë”±ë§ˆë¦¬ì¹˜í‚¨ â”€ ìŠ¤ì¼€ì¼ì—… ì‹œë®¬ë ˆì´í„°</h1>
      <div class="sub">í˜„ ë‹¨ê³„: <b>Level C ë§¤ì¥ 10ê°œ + ê´€ì œì„¼í„° 1ê³³</b> Â· ì¥ê¸°: <b>C â†’ B â†’ A</b> ë‹¨ê³„ ê³ ë„í™”</div>
    </div>
    <span class="tag">ì„ì›ìš© ìš”ì•½</span>
    <span class="tag">ì‹¤ì‹œê°„ ë¯¸ë¦¬ë³´ê¸°</span>
  </header>

  <nav>
    <a href="#simulator">ì‹œë®¬ë ˆì´í„°</a>
    <a href="#one">ê²°ë¡ </a>
    <a href="#capex">ì˜ˆì‚°</a>
    <a href="#opex">OPEX</a>
    <a href="#pnl">ë‹¨ìœ„ P&L</a>
    <a href="#total-pnl">ì´ê´„ P&L</a>
    <a href="#hq-pnl">ë³¸ì‚¬ P&L</a>
    <a href="#scenario">ë¹„êµ ë¶„ì„</a>
    <a href="#roadmap">ë¡œë“œë§µ</a>
  </nav>

  <!-- ìŠ¤ì¼€ì¼ì—… ì‹œë®¬ë ˆì´í„° -->
  <section id="simulator" class="sec-purple tint">
    <div class="secbar"></div>
    <div style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 10px; margin-bottom: 10px;">
        <h2 class="accentL" style="margin: 0;">âš™ï¸ ìŠ¤ì¼€ì¼ì—… ì‹œë®¬ë ˆì´í„°</h2>
        <div class="force-level-controls">
            <span class="k">ë ˆë²¨ ê°•ì œ ì „í™˜:</span>
            <button class="pill-btn active" id="force_level_auto">ìë™</button>
            <button class="pill-btn" id="force_level_c">Cë ˆë²¨</button>
            <button class="pill-btn" id="force_level_b">Bë ˆë²¨</button>
            <button class="pill-btn" id="force_level_a">Aë ˆë²¨</button>
        </div>
    </div>
    <div class="card">
      <label for="store_slider" style="margin-bottom: 8px;">ì…ë ¥: ì´ ë§¤ì¥ ìˆ˜ <span id="slider_val_display" style="font-weight: bold; color: var(--skyL);">10</span>ê°œ</label>
      <input id="store_slider" type="range" min="0" max="1000" value="0" style="width: 100%;">
      <div class="note" style="border-top: none; padding-top: 4px; margin-top: 4px;">ë“œë˜ê·¸í•˜ì—¬ ë§¤ì¥ ìˆ˜ ì¡°ì ˆ (10 ~ 20,000)</div>
      
      <button id="ai_params" class="btn" style="margin-top: 16px; border-top: 1px dashed var(--line); padding-top: 16px; width: 100%;">ğŸ¤– AI ì¶”ì²œ íŒŒë¼ë¯¸í„° ì ìš©</button>
      <div class="note" style="border-top: none; padding-top: 4px; margin-top: 4px;">í´ë¦­ ì‹œ, ì„¤ì •ëœ API í‚¤ë¥¼ ì‚¬ìš©í•˜ì—¬ AIê°€ ì¶”ë¡ í•œ ì‹œì¥ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.</div>
    </div>

    <div class="card" style="margin-top:12px">
      <div class="lead">ê²°ê³¼: ë™ì  ìš”ì•½</div>
      <div class="kpiBar" id="dynamic_summary" style="margin-top: 8px;">
        <span class="chip">ì´ ë§¤ì¥ ìˆ˜: <b id="summary_stores">10</b></span>
        <span class="chip clickable" id="summary_level_chip" title="í´ë¦­í•˜ì—¬ ìƒì„¸ ë‚´ì—­ ë³´ê¸°">ìë™í™” ë ˆë²¨: <b id="summary_level">Level C</b></span>
        <span class="chip">ë‹¨ìœ„ ì í¬ CAPEX: <b id="summary_capex">â‚©43,949,360</b></span>
      </div>
      <div class="note" style="border-top: none; padding-top: 4px; margin-top: 4px;">ë§¤ì¥ ìˆ˜ì— ë”°ë¼ ìë™í™” ë ˆë²¨, CAPEX, ì›ê°€, ì¸ê±´ë¹„ê°€ ìë™ ì¡°ì •ë©ë‹ˆë‹¤.</div>
    </div>
  </section>

  <!-- ê²°ë¡  -->
  <section id="one" class="sec-sky tint">
    <div class="secbar"></div>
    <h2 class="accentL">â‘  ê²°ë¡  <span class="pill">Sky</span></h2>
    <div class="grid g-3">
      <div class="card">
        <div class="k">í•µì‹¬ ì œì•ˆ</div>
        <div class="v" id="conclusion_proposal">10ê°œ <span style="color:var(--sky)">Level C</span></div>
        <div class="k" id="conclusion_staff">ë³¸ì‚¬/ê±°ì  ì´ì›: 8ëª…</div>
      </div>
      <div class="card">
        <div class="k">ì¥ê¸° ë°©í–¥</div>
        <div class="v">C â†’ B â†’ A</div>
        <div class="k">ê²Œì´íŠ¸ ì¶©ì¡± ì‹œ ë‹¨ê³„ ì „í™˜</div>
      </div>
      <div class="card">
        <div class="k">í˜„ì‹¤ì„±</div>
        <div class="v">ì¦‰ì‹œ ì°©ìˆ˜ ê°€ëŠ¥</div>
        <div class="k">êµ­ë‚´ ì¥ë¹„Â·ê·œì • ê¸°ë°˜</div>
      </div>
    </div>
    <div class="note" id="conclusion_staff_note"><b>ì£¼ì„</b> â€” ì´ì› 8ëª… êµ¬ì„±: ë³¸ì‚¬ 6ëª…(ì§€ì› 5ëª…, CS 1ëª…), ì§€ì ì¥ 0ëª…, ê¸°ìˆ ì§€ì› 1ëª…, ì¤‘ì•™ ì„¸ì²™/ì†Œë¶„ 0ëª… (Aë ˆë²¨), ìˆœíšŒ ê´€ë¦¬ 0ëª… (B/Aë ˆë²¨).</div>
  </section>

  <!-- ì˜ˆì‚° -->
  <section id="capex" class="sec-skyL tint">
    <div class="secbar"></div>
    <h2 class="accentL" id="capex_title">â‘¡ 10ê°œ ë§¤ì¥ íŒ¨í‚¤ì§€ ì˜ˆì‚° (CAPEX) <span class="pill">Sky Light</span></h2>
    
    <div class="grid g-2">
        <div class="card">
            <div class="k">ë‹¨ìœ„ ì í¬ CAPEX</div>
            <div class="v" id="capex_unit">â‚©43,949,360</div>
            <div class="k">ì°½ì—…ì›ê°€ (ë³´ì¦ê¸ˆ í¬í•¨)</div>
        </div>
        <div class="card">
            <div class="k">ì í¬ í•©ê³„</div>
            <div class="v" id="capex_stores_total">â‚©439,493,600</div>
            <div class="k" id="capex_stores_calc">10 Ã— 43.9M</div>
        </div>
    </div>

    <div class="lead" style="margin-top: 16px; font-size: 16px;">ë³¸ì‚¬ ë° ê±°ì  CAPEX</div>
    <div class="grid g-3" style="margin-top: 8px;">
        <div class="card">
            <div class="k">ë³¸ì‚¬(HQ) êµ¬ì„±ë¹„</div>
            <div class="v" id="capex_hq_base">â‚©50,000,000</div>
            <div class="k" id="capex_hq_desc">(ì´ 8ëª… ê·œëª¨)</div>
        </div>
        <div class="card">
            <div class="k">ì§€ì—­ ê±°ì  ë¹„ìš©</div>
            <div class="v" id="capex_regional_hubs">â‚©0</div>
            <div class="k" id="capex_regional_desc">0ê°œ ì§€ì  Ã— â‚©30M</div>
        </div>
        <div class="card">
            <div class="k">ì¸ë ¥ë³„ ì„¸íŒ…ë¹„</div>
            <div class="v" id="capex_per_employee">â‚©24,000,000</div>
            <div class="k" id="capex_employee_desc">8ëª… Ã— â‚©3M</div>
        </div>
    </div>
    
    <div class="grid g-2" style="margin-top:10px">
      <div class="card"><div class="k">ì†Œê³„</div><div class="v" id="capex_subtotal">â‚©513,493,600</div></div>
      <div class="card"><div class="k">ì»¨í‹´ì „ì‹œ(5%)</div><div class="v" id="capex_contingency">â‚©25,674,680</div></div>
    </div>
    <div class="card" style="margin-top:10px"><div class="k">íŒ¨í‚¤ì§€ CAPEX í•©ê³„</div><div class="v" id="capex_total">â‚©539,168,280</div><div class="k">ë¶€ê°€ì„¸Â·ìš´ì†¡Â·ì „ê¸°Â·ë•íŠ¸Â·ì†Œë°© ì—°ë™ ë³„ë„</div></div>
    <div class="note"><b>ì£¼ì„</b> â€” CAPEX: ì´ˆê¸° ì„¤ë¹„íˆ¬ì / ì»¨í‹´ì „ì‹œ: ì˜ˆë¹„ë¹„(5%) / <b>ë³¸ì‚¬/ê±°ì  CAPEX ì‚°ì¶œ</b>: ë³¸ì‚¬ ê·œëª¨ë³„ êµ¬ì„±ë¹„ + (ì§€ì—­ ê±°ì  ìˆ˜ Ã— ê±°ì ë‹¹ êµ¬ì„±ë¹„) + (1ì¸ë‹¹ ì„¸íŒ…ë¹„ Ã— ì´ ì¸ì› ìˆ˜)ë¡œ ê³„ì‚°ë©ë‹ˆë‹¤.</div>
  </section>

  <!-- OPEX -->
  <section id="opex" class="sec-green tint">
    <div class="secbar"></div>
    <h2 class="accentL">â‘¢ ì›” OPEX (ê³ ì •ì„±) <span class="pill">Green</span></h2>
    <table>
      <thead><tr><th>í•­ëª©(1ì í¬)</th><th>ê°€ì •</th><th>ì›” ë¹„ìš©</th></tr></thead>
      <tbody>
        <tr id="opex_labor_row"><td>ì¸ê±´ë¹„(ì¸ìƒ ì‹œê¸‰ ê¸°ì¤€)</td><td id="opex_labor_desc">13h/ì¼ Ã— 30ì¼ Ã— 12,384ì› Ã— 1.2ëª…</td><td id="opex_labor_cost">â‚©5,763,744</td></tr>
        <tr id="opex_rent_row"><td>ì„ëŒ€ë£Œ(ê´€ë¦¬ë¹„í¬í•¨/ì›”)</td><td>ê³ ì •</td><td id="opex_rent_cost">â‚©1,000,000</td></tr>
        <tr id="opex_saas_row"><td>POSÂ·ì¸í„°ë„·(ì›”)</td><td>ê³ ì •</td><td id="opex_saas_cost">â‚©150,000</td></tr>
        <tr id="opex_center_row"><td>ì„¼í„° ì„œë¹„ìŠ¤(ì í¬ ëª«)</td><td id="opex_center_desc">CS, ë°°ë‹¬í”Œë«í¼ ê´€ë¦¬, ê¸°ìˆ ì§€ì›</td><td id="opex_center_cost">â‚©3,790,000</td></tr>
        <tr><th>í•©ê³„(1ì í¬)</th><th></th><th id="opex_total">â‚©10,703,744</th></tr>
      </tbody>
    </table>
    <div class="note"><b>ì£¼ì„</b> â€” OPEX: ì›” ìš´ì˜ë¹„ / FTE: Fullâ€‘Time Equivalent(ìƒê·¼ ì¸ë ¥ í™˜ì‚°)</div>
  </section>

  <!-- ë‹¨ìœ„ ì í¬ ì†ìµí‘œ (P&L) -->
  <section id="pnl" class="sec-purple tint">
    <div class="secbar"></div>
    <h2 class="accentL">â‘£ ë‹¨ìœ„ ì í¬ ì†ìµí‘œ(P&L, ì›”) <span class="pill">Purple</span></h2>

    <div class="grid g-2">
      <div class="card">
        <div class="lead">ì…ë ¥(ì í¬)</div>
        <label>ê°ë‹¨ê°€ AOV(ì›) <input id="pl_aov" type="text" value="22,900" /></label>
        <label>ì¼ ì£¼ë¬¸ëŸ‰(ê±´/ì¼) <input id="pl_units_day" type="text" value="80" /></label>
        <label>ì›ìœ¡ 600g (ë‹¨ìœ„ ì›ê°€) <input id="pl_raw_meat" type="text" value="5,700" /></label>
        <label>ë§¤ì¥ê°€ê³µ (ë‹¨ìœ„ ì›ê°€) <input id="pl_proc_cost" type="text" value="700" /></label>
        <label>í¬ì¥ ë° ì„œë¹„ìŠ¤ë©”ë‰´ (ë‹¨ìœ„ ì›ê°€) <input id="pl_pkg_cost" type="text" value="1,500" /></label>
        <label>ì‚¬ì´ë“œë©”ë‰´ ì›ê°€ë¹„ìš© <input id="pl_service_cost" type="text" value="2,000" /></label>
        <label>í”Œë«í¼ ìˆ˜ìˆ˜ë£Œ(0~1) <input id="pl_pf" type="text" value="0.25" /></label>
        <label>ì„ëŒ€ë£Œ(ê´€ë¦¬ë¹„í¬í•¨/ì›”) <input id="pl_rent" type="text" value="1,000,000" /></label>
        <label>ë§¤ì¶œ ëŒ€ë¹„ ê³µê³¼ê¸ˆÂ·ì†Œëª¨í’ˆ ë¹„ìœ¨(0~1) <input id="pl_util_rate" type="text" value="0.04" /></label>
        <label>POSÂ·ì¸í„°ë„·(ì›”) <input id="pl_saas" type="text" value="150,000" /></label>
      </div>
      <div class="card">
          <div class="lead">ì¸ê±´ë¹„ & ìš´ì˜ ê¸°ë³¸ ê°€ì •</div>
          <label>ê·¼ë¬´ì‹œê°„(ì‹œê°„/ì¼) <input id="pl_hours" type="text" value="13" /></label>
          <label>ê¸°ë³¸ ì‹œê¸‰(ì›) <input id="pl_base_wage" type="text" value="10,030" readonly /></label>
          <label>ì±…ì • ì‹œê¸‰ ìŠ¹ìˆ˜ (AI ì¶”ì²œ) <input id="pl_wage_multiplier" type="text" value="1.2" /></label>
          <label>ì±…ì • ì‹œê¸‰ (ê¸°ë³¸ Ã— ìŠ¹ìˆ˜) <input id="pl_calc_wage" type="text" value="12,036" readonly /></label>
          <label>ì›” ì¼ìˆ˜ <input id="pl_days" type="text" value="30" /></label>
          <div class="note" style="border:none; padding:0; margin-top: 8px;">ëª¨ë“  ì¸ê±´ë¹„ ê³„ì‚°ì˜ ê¸°ì´ˆê°€ ë˜ëŠ” ê°’ì…ë‹ˆë‹¤.</div>
          
          <div id="assumptions_card">
              <div class="lead" id="assumptions_level_title" style="margin-top: 16px;">ë¬¼ë¥˜ ë° Cë ˆë²¨ ê°€ì •</div>
              <label>COGS ëŒ€ë¹„ 3PL ë¹„ìœ¨(0~1) <input id="pl_3pl_rate" type="text" value="0.03" /></label>
              
              <div id="pl_b_savings_container">
                   <label>ìë™í™” ì¸ë ¥ ì ˆê°ìœ¨ (<span id="pl_b_level_label">Cë ˆë²¨</span>) <input id="pl_b_savings" type="text" value="0.15" /></label>
              </div>
              
              <div id="pl_patrol_container">
                  <label>ìˆœíšŒ ê´€ë¦¬ ì¸ë ¥ 1ì¸ë‹¹ ë‹´ë‹¹ ë§¤ì¥ ìˆ˜ (<span id="pl_patrol_stores_label">Cë ˆë²¨</span>) <input id="pl_patrol_stores" type="text" value="---" disabled/></label>
                  <label>ìˆœíšŒ ê´€ë¦¬ ì¸ë ¥ ì‹œê¸‰ ìŠ¹ìˆ˜ (<span id="pl_patrol_wage_label">Cë ˆë²¨</span>) <input id="pl_patrol_wage" type="text" value="---" disabled/></label>
              </div>
              
              <div id="pl_washing_container">
                  <label>ì¤‘ì•™ ì„¸ì²™/ì†Œë¶„ ì¸ë ¥ 1ì¸ë‹¹ ë‹´ë‹¹ ë§¤ì¥ ìˆ˜ (<span id="pl_washing_stores_label">Cë ˆë²¨</span>) <input id="pl_washing_stores" type="text" value="---" disabled/></label>
                  <label>ì¤‘ì•™ ì„¸ì²™/ì†Œë¶„ ì¸ë ¥ ì‹œê¸‰ ìŠ¹ìˆ˜ (<span id="pl_washing_wage_label">Cë ˆë²¨</span>) <input id="pl_washing_wage" type="text" value="---" disabled/></label>
              </div>
          </div>

          <label>ì í¬ CAPEX(íšŒìˆ˜ê¸°ê°„ ê³„ì‚°) <input id="pl_capex" type="text" value="43,949,360" readonly /></label>
          
          <div class="row" style="margin-top: 16px;"><button class="btn" id="apply_changes">ì…ë ¥ê°’ ìµœì¢… ë°˜ì˜</button></div>
      </div>
    </div>

    <div class="grid g-2" style="margin-top:10px">
      <div class="card">
        <div class="lead">ì†ìµ ê²°ê³¼ ìš”ì•½</div>
        <div class="kpiBar">
          <span class="chip"><b>ë§¤ì¶œ</b> <span id="pl_rev">-</span></span>
          <span class="chip"><b>COGS</b> <span id="pl_cogs_ratio">-</span></span>
          <span class="chip"><b>ë³€ë™ë¹„</b> <span id="pl_var">-</span></span>
          <span class="chip"><b>ê³ ì •ë¹„</b> <span id="pl_fix">-</span></span>
          <span class="chip"><b>EBITDA</b> <span id="pl_ebitda">-</span></span>
          <span class="chip"><b>ë§ˆì§„</b> <span id="pl_margin">-</span></span>
          <span class="chip"><b>ì†ìµë¶„ê¸°</b> <span id="pl_bep">-</span></span>
          <span class="chip"><b>Payback</b> <span id="pl_pay">-</span></span>
        </div>
      </div>
      <div class="card">
        <div class="lead">ë¹„ìš© êµ¬ì¡°(ë„ë„›)</div>
        <div style="display:flex;gap:16px;align-items:center;flex-wrap:wrap">
          <canvas id="pl_donut" width="230" height="230"></canvas>
          <div class="legend-rows" id="pl_legend"></div>
        </div>
      </div>
    </div>

    <div class="card" style="margin-top:10px">
      <div class="lead">ì†ìµí‘œ (ì›”Â·1ì í¬)</div>
      <table>
        <thead><tr><th>í•­ëª©</th><th>ê¸ˆì•¡(ì›)</th><th>ì„¤ëª…</th></tr></thead>
        <tbody>
          <tr><td>ë§¤ì¶œ</td><td id="pl_t_rev">-</td><td class="k">AOV Ã— ì¼ ì£¼ë¬¸ Ã— 30</td></tr>
          <tr><td>ë§¤ì¶œì›ê°€(COGS)</td><td id="pl_t_cogs_abs">-</td><td id="pl_t_cogs_ratio" class="k">ë§¤ì¶œì˜ -%</td></tr>
          <tr><td>í”Œë«í¼ ìˆ˜ìˆ˜ë£Œ</td><td id="pl_t_pf">-</td><td class="k" id="pl_t_pf_desc">= ë§¤ì¶œ Ã— -%</td></tr>
          <tr><td>ê³µê³¼ê¸ˆÂ·ì†Œëª¨í’ˆ</td><td id="pl_t_util">-</td><td class="k" id="pl_t_util_desc">ë§¤ì¶œì˜ -% (ë³€ë™ì„± ë°˜ì˜)</td></tr>
          <tr><td>3PL ë°°ì†¡ë£Œ</td><td id="pl_t_3pl">-</td><td class="k" id="pl_t_3pl_desc">ë§¤ì¶œì›ê°€(COGS)ì˜ -%</td></tr>
          <tr><td>ë§¤ì¶œì´ìµ(ê¸°ì—¬ì´ìµ)</td><td id="pl_t_cm">-</td><td class="k">ë§¤ì¶œ âˆ’ ë³€ë™ë¹„</td></tr>
          <tr><td>ì¸ê±´ë¹„</td><td id="pl_t_labor">-</td><td class="k" id="pl_t_labor_desc">13h/ì¼ Ã— 30ì¼ Ã— 12,384ì› Ã— 1.2ëª…</td></tr>
          <tr><td>ì„ëŒ€ë£Œ(ê´€ë¦¬ë¹„í¬í•¨/ì›”)</td><td id="pl_t_rent">-</td><td class="k">ë°°ë‹¬ì „ë¬¸ ì†Œí˜•</td></tr>
          <tr><td>POSÂ·ì¸í„°ë„·(ì›”)</td><td id="pl_t_saas">-</td><td class="k">POSÂ·IOMSÂ·ëª¨ë‹ˆí„°ë§</td></tr>
          <tr><td>ì„¼í„° ì„œë¹„ìŠ¤(ì í¬ ëª«)</td><td id="pl_t_centerStore">-</td><td class="k" id="pl_t_centerStore_desc">ì„¸ì²™Â·QAÂ·ìˆœíšŒ</td></tr>
          <tr><td>ì í¬ EBITDA</td><td id="pl_t_ebitda">-</td><td class="k" id="pl_t_margin" class="k">ë§ˆì§„ -%</td></tr>
          <tr><td>ì†ìµë¶„ê¸°ì </td><td id="pl_t_bep">-</td><td class="k">ì¼ ê¸°ì¤€(ë§ˆë¦¬/ì¼)</td></tr>
          <tr><td>íˆ¬ì íšŒìˆ˜ê¸°ê°„</td><td id="pl_t_payback">-</td><td class="k">= CAPEX Ã· EBITDA</td></tr>
        </tbody>
      </table>
      <div class="note"><b>ì£¼ì„</b> â€” <u>ê³„ì‚° êµ¬ì¡°</u>ëŠ” ì—…ë¡œë“œ ìë£Œì˜ ë°©ì‹(= ê¸°ì—¬ì´ìµ ì •ì˜, 3PLì€ ë§¤ì¶œì›ê°€(COGS)ì˜ ì¼ì • ë¹„ìœ¨ ë“±)ì„ ë°˜ì˜í–ˆìŠµë‹ˆë‹¤. ì‹¤ì œ ê³„ì•½Â·ìƒê¶Œë³„ë¡œ ê°’ë§Œ ì¡°ì •í•˜ì‹œë©´ ë©ë‹ˆë‹¤.</div>
    </div>
  </section>
  
  <!-- ì´ê´„ ì†ìµí‘œ -->
  <section id="total-pnl" class="sec-purple tint">
    <div class="secbar"></div>
    <h2 class="accentL">â‘£-1 ì´ê´„ ì†ìµí‘œ (Total P&L, ë…„) <span class="pill">Purple</span></h2>
    <div class="card">
        <div class="lead">íŒ¨í‚¤ì§€ ê²°ê³¼ ìš”ì•½ (ë…„)</div>
        <div class="kpiBar">
          <span class="chip"><b>ì´ ë§¤ì¶œ</b> <span id="p_rev">-</span></span>
          <span class="chip"><b>ì´ COGS</b> <span id="p_cogs_ratio">-</span></span>
          <span class="chip"><b>ì´ ë³€ë™ë¹„</b> <span id="p_var">-</span></span>
          <span class="chip"><b>ì´ ê³ ì •ë¹„</b> <span id="p_fix">-</span></span>
          <span class="chip"><b>ì´ EBITDA</b> <span id="p_ebitda">-</span></span>
          <span class="chip"><b>Payback</b> <span id="p_pay">-</span></span>
        </div>
    </div>
    <div class="card" style="margin-top:10px">
      <div class="lead">ì´ê´„ ì†ìµí‘œ (ë…„)</div>
      <table>
        <thead><tr><th>í•­ëª©</th><th>ê¸ˆì•¡(ì›)</th><th>ì„¤ëª…</th></tr></thead>
        <tbody>
          <tr><td>ì´ ë§¤ì¶œ</td><td id="p_t_rev">-</td><td class="k">ë‹¨ìœ„ì í¬ ë§¤ì¶œ Ã— ì´ ë§¤ì¥ ìˆ˜ Ã— 12ê°œì›”</td></tr>
          <tr><td>ì´ ë§¤ì¶œì›ê°€(COGS)</td><td id="p_t_cogs_abs">-</td><td id="p_t_cogs_ratio" class="k">ì´ ë§¤ì¶œì˜ -%</td></tr>
          <tr><td>ì´ ë³€ë™ë¹„ (COGS ì œì™¸)</td><td id="p_t_var_etc">-</td><td class="k">í”Œë«í¼, ê³µê³¼ê¸ˆ, 3PL</td></tr>
          <tr><td>ì´ ë§¤ì¶œì´ìµ</td><td id="p_t_cm">-</td><td class="k">ì´ ë§¤ì¶œ âˆ’ ì´ ë³€ë™ë¹„</td></tr>
          <tr><td>ì´ ê³ ì •ë¹„ (ë§¤ì¥)</td><td id="p_t_fix_store">-</td><td class="k">(ì¸ê±´ë¹„, ì„ëŒ€ë£Œ, SaaS) Ã— ì´ ë§¤ì¥ ìˆ˜ Ã— 12ê°œì›”</td></tr>
          <tr id="total_pnl_center_wage_row"><td>ë³¸ì‚¬ ë° ì§€ì› ì¸ê±´ë¹„ (HQ+ê±°ì )</td><td id="p_t_center_wage">-</td><td class="k">ë³¸ì‚¬, CS, ê¸°ìˆ ì§€ì›, ì§€ì ì¥ ë“± ì¸ê±´ë¹„ Ã— 12ê°œì›”</td></tr>
          <tr id="total_pnl_washing_wage_row" style="display: none;"><td>ì¤‘ì•™ ì„¸ì²™/ì†Œë¶„ ì¸ê±´ë¹„(Aë ˆë²¨)</td><td id="p_t_washing_wage">-</td><td class="k">ì•¼ê°„ ê·¼ë¬´, ì›” ì¸ê±´ë¹„ Ã— 12ê°œì›”</td></tr>
          <tr id="total_pnl_patrol_wage_row" style="display: none;"><td>ìˆœíšŒ ê´€ë¦¬ ì¸ê±´ë¹„(B/Aë ˆë²¨)</td><td id="p_t_patrol_wage">-</td><td class="k">ìˆœíšŒ ì¸ë ¥, ì›” ì¸ê±´ë¹„ Ã— 12ê°œì›”</td></tr>
          <tr><td>ì´ EBITDA</td><td id="p_t_ebitda">-</td><td class="k" id="p_t_margin" class="k">ë§ˆì§„ -%</td></tr>
          <tr><td>ì´ íˆ¬ì íšŒìˆ˜ê¸°ê°„</td><td id="p_t_payback">-</td><td class="k">= ì´ CAPEX Ã· ì´ EBITDA</td></tr>
        </tbody>
      </table>
    </div>
  </section>

  <!-- ë³¸ì‚¬ ì†ìµí‘œ -->
  <section id="hq-pnl" class="sec-purple tint">
    <div class="secbar"></div>
    <h2 class="accentL">â‘£-2 ë³¸ì‚¬ ê°€ë§¹ ì‚¬ì—… ì†ìµí‘œ (ê°€ì •, ë…„) <span class="pill">Purple</span></h2>
    <div class="card">
        <label>ë³¸ì‚¬ ë¬¼ë¥˜ ë§ˆì§„ìœ¨(0~1) <input id="hq_margin_rate" type="text" value="0.25" /></label>
    </div>
    <div class="card" style="margin-top:10px">
      <div class="lead">ë³¸ì‚¬ ì†ìµí‘œ (ë…„)</div>
      <table>
        <thead><tr><th>í•­ëª©</th><th>ê¸ˆì•¡(ì›)</th><th>ì„¤ëª…</th></tr></thead>
        <tbody>
          <tr><td>ì´ ê³µê¸‰ê°€ì•¡ (ì „ì²´ ë§¤ì¥ COGS)</td><td id="hq_t_cogs">-</td><td class="k">ì „ì²´ ë§¤ì¥ì— ê³µê¸‰ëœ ì›ë¶€ìì¬ ì´ì•¡</td></tr>
          <tr><td>ë³¸ì‚¬ ë¬¼ë¥˜ ìˆ˜ìµ</td><td id="hq_t_revenue">-</td><td id="hq_t_revenue_desc" class="k">ì´ ê³µê¸‰ê°€ì•¡ Ã— -%</td></tr>
          <tr id="hq_pnl_center_wage_row"><td>ë³¸ì‚¬ ë° ì§€ì› ì¸ê±´ë¹„ (HQ+ê±°ì )</td><td id="hq_t_center_wage">-</td><td class="k">ë³¸ì‚¬, CS, ê¸°ìˆ ì§€ì›, ì§€ì ì¥ ë“± ì¸ê±´ë¹„ Ã— 12ê°œì›”</td></tr>
          <tr id="hq_pnl_washing_wage_row" style="display: none;"><td>ì¤‘ì•™ ì„¸ì²™/ì†Œë¶„ ì¸ê±´ë¹„(Aë ˆë²¨)</td><td id="hq_t_washing_wage">-</td><td class="k">ì•¼ê°„ ê·¼ë¬´, ì›” ì¸ê±´ë¹„ Ã— 12ê°œì›”</td></tr>
           <tr id="hq_pnl_patrol_wage_row" style="display: none;"><td>ìˆœíšŒ ê´€ë¦¬ ì¸ê±´ë¹„(B/Aë ˆë²¨)</td><td id="hq_t_patrol_wage">-</td><td class="k">ìˆœíšŒ ì¸ë ¥, ì›” ì¸ê±´ë¹„ Ã— 12ê°œì›”</td></tr>
          <tr><td>ë³¸ì‚¬ EBITDA</td><td id="hq_t_ebitda">-</td><td class="k">ë¬¼ë¥˜ ìˆ˜ìµ âˆ’ ë³¸ì‚¬ ì¸ê±´ë¹„</td></tr>
          <tr><td>ë³¸ì‚¬ íˆ¬ì(ì„¼í„°) íšŒìˆ˜ê¸°ê°„</td><td id="hq_t_payback">-</td><td class="k">= ì„¼í„° CAPEX Ã· ë³¸ì‚¬ EBITDA</td></tr>
        </tbody>
      </table>
    </div>
  </section>


  <!-- ì‹œë‚˜ë¦¬ì˜¤ ë¹„êµ -->
  <section id="scenario" class="sec-purple tint">
      <div class="secbar"></div>
      <h2 class="accentL">â‘¥ ì‹œë‚˜ë¦¬ì˜¤ ë¹„êµ ë¶„ì„ <span class="pill">Purple</span></h2>
      <div class="grid g-2">
          <div class="card">
              <div class="lead">í˜„ì¬ ì‹œë®¬ë ˆì´ì…˜ (ë‹¨ìœ„ ì í¬)</div>
              <div class="kpiBar" id="s_current_kpis">
                  <span class="chip"><b>ë§¤ì¶œ</b> <span id="s_rev">-</span></span>
                  <span class="chip"><b>COGS</b> <span id="s_cogs_ratio">-</span></span>
                  <span class="chip"><b>ë³€ë™ë¹„</b> <span id="s_var">-</span></span>
                  <span class="chip"><b>ê³ ì •ë¹„</b> <span id="s_fix">-</span></span>
                  <span class="chip"><b>EBITDA</b> <span id="s_ebitda">-</span></span>
                  <span class="chip"><b>ë§ˆì§„</b> <span id="s_margin">-</span></span>
                  <span class="chip"><b>Payback</b> <span id="s_pay">-</span></span>
              </div>
          </div>
          <div class="card">
              <div class="lead">ê³ ì • 10C ì‹œë‚˜ë¦¬ì˜¤ (ë‹¨ìœ„ ì í¬)</div>
              <div class="kpiBar" id="s_fixed_kpis">
                  <span class="chip"><b>ë§¤ì¶œ</b> <span id="f_rev">-</span></span>
                  <span class="chip"><b>COGS</b> <span id="f_cogs_ratio">-</span></span>
                  <span class="chip"><b>ë³€ë™ë¹„</b> <span id="f_var">-</span></span>
                  <span class="chip"><b>ê³ ì •ë¹„</b> <span id="f_fix">-</span></span>
                  <span class="chip"><b>EBITDA</b> <span id="f_ebitda">-</span></span>
                  <span class="chip"><b>ë§ˆì§„</b> <span id="f_margin">-</span></span>
                  <span class="chip"><b>Payback</b> <span id="f_pay">-</span></span>
              </div>
          </div>
      </div>
      <div class="note"><b>ì£¼ì„</b> â€” EBITDA: ì´ìÂ·ì„¸ê¸ˆÂ·ê°ê°€ìƒê° ì „ ì˜ì—…ì´ìµ / Payback: ì´ˆê¸°íˆ¬ì íšŒìˆ˜ê¸°ê°„</div>
  </section>
  
  <!-- í”Œë¡œìš° -->
  <section id="flow" class="sec-indigo tint">
    <div class="secbar"></div>
    <h2 class="accentL">â‘¤ ìš´ì˜ í”Œë¡œìš° <span class="pill">Indigo</span></h2>
     <table>
      <thead><tr><th>ë‹¨ê³„</th><th>í•µì‹¬</th><th>ë¹„ê³ </th></tr></thead>
      <tbody>
        <tr><td>ì£¼ë¬¸ í†µí•©(IOMS)</td><td>ë°°ë¯¼/ìš”ê¸°ìš”/ì¿ íŒ¡ì´ì¸ /ë„¤ì´ë²„ ìë™ì ‘ìˆ˜</td><td class="k">ì¤‘ë³µÂ·ì˜¤ì…ë ¥ ìµœì†Œí™”</td></tr>
        <tr><td>KDS</td><td>ìš°ì„ ìˆœìœ„/ì•½ì†ì‹œê°„ ì œì–´</td><td class="k">í”¼í¬ íƒ€ì„ ê´€ë¦¬</td></tr>
        <tr><td>2ì°¨ íŠ€ê¹€(3')</td><td>OQS/ATO/ìë™í•„í„°</td><td class="k">í’ˆì§ˆÂ·ì˜¤ì¼ ìˆ˜ëª… í™•ë³´</td></tr>
        <tr><td>ì–‘ë…</td><td>ì •ëŸ‰ ë””ìŠ¤íœì„œ + ì§§ì€ í† ìŠ¤</td><td class="k">ì¼ê´€ì„±Â·ìœ„ìƒ</td></tr>
        <tr><td>í¬ì¥</td><td>ë°˜ìë™ í…Œì´í•‘/ì œí•¨ ë³´ì¡°</td><td class="k">ì†ë„ ì•ˆì •í™”</td></tr>
        <tr><td>ë³´ì˜¨/í”½ì—…</td><td>ë³´ì˜¨ì¥ + ë””ì§€í„¸ ì„ ë°˜</td><td class="k">B ë‹¨ê³„ì—ì„œ ë½ì»¤ ì „í™˜</td></tr>
        <tr><td>ë¼ì´ë” ìˆ˜ë ¹</td><td>ë¬´ì¸ ì¸ë„</td><td class="k">ëŒ€ê¸° ìµœì†Œí™”</td></tr>
      </tbody>
    </table>
    <div class="note"><b>ì£¼ì„</b> â€” IOMS: ì£¼ë¬¸ í†µí•© / KDS: ì£¼ë°© ë””ìŠ¤í”Œë ˆì´ / OQS: Oil Quality Sensor / ATO: Auto Topâ€‘Up</div>
  </section>

  <!-- ì„¼í„° -->
  <section id="center" class="sec-teal tint">
      <div class="secbar"></div>
      <h2 class="accentL">â‘¦ ê´€ì œì„¼í„° ì—­í•  <span class="pill">Teal</span></h2>
      <table>
          <thead>
              <tr>
                  <th>ì—­í• </th>
                  <th>í•µì‹¬ ì—…ë¬´</th>
                  <th>ì ìš© ë ˆë²¨</th>
              </tr>
          </thead>
          <tbody>
              <tr>
                  <td><b>ë³¸ì‚¬ (HQ)</b></td>
                  <td colspan="2" class="k">ë³¸ì‚¬ ê¸°ëŠ¥</td>
              </tr>
              <tr>
                  <td>â”£ ê²½ì˜/ê¸°íš</td>
                  <td>ì „ëµ, ì¬ë¬´, ë²•ë¬´, ë§ˆì¼€íŒ… ë“±</td>
                  <td><span class="pill">C</span> <span class="pill">B</span> <span class="pill">A</span></td>
              </tr>
               <tr>
                  <td>â”£ CS (ê³ ê° ì„œë¹„ìŠ¤)</td>
                  <td>ì „í™”/ì•±ì„ í†µí•œ ì£¼ë¬¸Â·ë¬¸ì˜ í†µí•© ëŒ€ì‘</td>
                  <td><span class="pill">C</span> <span class="pill">B</span> <span class="pill">A</span></td>
              </tr>
              <tr>
                  <td><b>ì›ê²© ê´€ì œ (ê±°ì )</b></td>
                  <td colspan="2" class="k">ì›ê²© ê´€ì œ ë° ëª¨ë‹ˆí„°ë§</td>
              </tr>
              <tr>
                  <td>â”£ ì£¼ë¬¸ í†µí•©</td>
                  <td>IOMSë¥¼ í†µí•œ ì£¼ë¬¸ ìë™ ì ‘ìˆ˜ ë° ê´€ë¦¬</td>
                  <td><span class="pill">C</span> <span class="pill">B</span> <span class="pill">A</span></td>
              </tr>
               <tr>
                  <td>â”£ ê¸°ìˆ  ì§€ì› (ì¥ë¹„ A/S)</td>
                  <td>ìë™í™” ì¥ë¹„ ì›ê²© ì§„ë‹¨, í˜„ì¥ A/S ì¡°ìœ¨</td>
                  <td><span class="pill">C</span> <span class="pill">B</span> <span class="pill">A</span></td>
              </tr>
              <tr>
                  <td>â”£ ë°°ë‹¬ í”Œë«í¼ ê´€ë¦¬</td>
                  <td>í”„ë¡œëª¨ì…˜, ë©”ë‰´, ìš´ì˜ì‹œê°„ ë“± í”Œë«í¼ ê´€ë¦¬</td>
                  <td><span class="pill">C</span> <span class="pill">B</span> <span class="pill">A</span></td>
              </tr>
              <tr>
                  <td>â”£ CCTV ëª¨ë‹ˆí„°ë§</td>
                  <td>ë§¤ì¥ ì•ˆì „, ìœ„ìƒ, ìš´ì˜ìƒí™© ì‹¤ì‹œê°„ í™•ì¸</td>
                  <td><span class="pill">C</span> <span class="pill">B</span> <span class="pill">A</span></td>
              </tr>
              <tr>
                  <td><b>ì¤‘ì•™ ì§€ì› (ê±°ì )</b></td>
                  <td colspan="2" class="k">ì¤‘ì•™ ì§€ì› ë° ë¬¼ë¥˜</td>
              </tr>
              <tr>
                  <td>â”£ ì¤‘ì•™ ì„¸ì²™/ì†Œë¶„</td>
                  <td>ì›ë¶€ìì¬ì˜ ì¤‘ì•™ ì§‘ì¤‘ì‹ ì „ì²˜ë¦¬</td>
                  <td><span class="pill" style="background:var(--amber); color:var(--bg)">A</span></td>
              </tr>
              <tr>
                  <td>â”£ ìˆœíšŒ ê´€ë¦¬</td>
                  <td>ë‹´ë‹¹ ë§¤ì¥ ìˆœíšŒí•˜ë©° ê°œì /íì /ë³´ì¶© ë° í˜„ì¥ ì†Œë¶„/í¬ì¥</td>
                  <td><span class="pill" style="background:var(--rose); color:var(--bg)">B</span> <span class="pill" style="background:var(--amber); color:var(--bg)">A</span></td>
              </tr>
          </tbody>
      </table>
      <div class="note"><b>ì£¼ì„</b> â€” ê´€ì œì„¼í„°ì˜ ì—­í• ì€ ìë™í™” ë ˆë²¨(A/B/C)ì— ë”°ë¼ í™•ì¥ ë° ë³€í™”í•©ë‹ˆë‹¤.</div>
  </section>

  <!-- ê·œì • -->
  <section id="comp" class="sec-rose tint">
    <div class="secbar"></div>
    <h2 class="accentL">â‘§ ë¦¬ìŠ¤í¬ í†µì œ & ì»´í”Œë¼ì´ì–¸ìŠ¤ <span class="pill">Rose</span></h2>
     <div style="display: flex; flex-direction: column; gap: 12px; margin-top: 12px;">
      <div>
          <b class="pill">ìœ„ìƒ ê´€ë¦¬</b>
          <p style="margin: 4px 0 0; font-size: 14px;">ì‹í’ˆì˜ì•½í’ˆì•ˆì „ì²˜ì˜ ë¬´ì¸ ë§¤ì¥ ìœ„ìƒ ì§€ì¹¨ì„ ì² ì €íˆ ì¤€ìˆ˜í•©ë‹ˆë‹¤. ì—¬ê¸°ì—ëŠ” ì‹ìì¬ì˜ ë³´ê´€ ì˜¨ë„, ì¡°ë¦¬ ê¸°êµ¬ì˜ ì„¸ì²™ ì£¼ê¸°, ìœ í†µê¸°í•œ ê´€ë¦¬, ì§ì›ì˜ ìœ„ìƒ êµìœ¡ ë“±ì´ í¬í•¨ë©ë‹ˆë‹¤.</p>
      </div>
      <div>
          <b class="pill">ì•ˆì „ ì œì¼</b>
          <p style="margin: 4px 0 0; font-size: 14px;">ì£¼ë°© ì‹ìš©ìœ  í™”ì¬ì— íŠ¹í™”ëœ Kê¸‰ ì†Œí™”ê¸°ë¥¼ ë¹„ì¹˜í•˜ê³ , í™”ì¬ ë°œìƒ ì‹œ ê°€ìŠ¤ì™€ ì „ì›ì„ ìë™ìœ¼ë¡œ ì°¨ë‹¨í•˜ëŠ” ì£¼ë°©ìë™ì†Œí™”ì¥ì¹˜ë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤. ë˜í•œ, ìœ„í—˜ ìƒí™© ì‹œ ì¦‰ì‹œ ê¸°ê³„ ì‘ë™ì„ ë©ˆì¶”ëŠ” ë¹„ìƒì •ì§€ ì‹œìŠ¤í…œì„ ê°–ì·„ìŠµë‹ˆë‹¤.</p>
      </div>
      <div>
          <b class="pill">ì¼ê´€ëœ í’ˆì§ˆ</b>
          <p style="margin: 4px 0 0; font-size: 14px;">ëª¨ë“  ì†ŒìŠ¤ëŠ” ê·œê²©í™”ëœ íŒŒìš°ì¹˜ í˜•íƒœë¡œ ê³µê¸‰í•˜ê³ , ì •ëŸ‰ ë””ìŠ¤íœì„œë¥¼ ì‚¬ìš©í•´ ì–¸ì œë‚˜ ë™ì¼í•œ ì–‘ì„ ì œê³µí•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ì „êµ­ ëª¨ë“  ë§¤ì¥ì—ì„œ ë˜‘ê°™ì€ ë§›ê³¼ í’ˆì§ˆì„ ìœ ì§€í•©ë‹ˆë‹¤.</p>
      </div>
       <div>
          <b class="pill">ìš´ì˜ íˆ¬ëª…ì„±</b>
          <p style="margin: 4px 0 0; font-size: 14px;">CCTVë¥¼ í†µí•´ ì›ê²©ìœ¼ë¡œ ë§¤ì¥ ìƒí™©ì„ ì‹¤ì‹œê°„ ê´€ì œí•˜ë©°, ë§¤ì¼ ë§¤ì¥ì„ ì—´ê³  ë‹«ì„ ë•Œë§ˆë‹¤ ì •í•´ì§„ ì²´í¬ë¦¬ìŠ¤íŠ¸ì— ë”°ë¼ ì ê²€í•˜ì—¬ ìš´ì˜ìƒì˜ ì‹¤ìˆ˜ë¥¼ ìµœì†Œí™”í•©ë‹ˆë‹¤.</p>
      </div>
    </div>
  </section>

  <!-- ë¡œë“œë§µ -->
  <section id="roadmap" class="sec-amber tint">
    <div class="secbar"></div>
    <h2 class="accentL">â‘¨ ë‹¨ê³„ì  ê³ ë„í™” ë¡œë“œë§µ (A/B/C ëª…í™•í™”) <span class="pill">Amber</span></h2>
    <div class="grid g-3">
      <div class="card">
        <div class="lead">Level C â€” ìµœì†Œ ì¸ë ¥</div>
        <ul class="list" style="margin:8px 0 0 18px">
          <li>ìƒì‹œ 1.2ì¸ (í”¼í¬ ëŒ€ì‘)</li>
          <li>í”„ë¼ì´ì–´ OQS/ATO/ìë™í•„í„°, ë³´ì˜¨/í”½ì—… ì„ ë°˜, KDS</li>
          <li id="roadmap_capex_c"><b>ì°½ì—…ì›ê°€(ë³´ì¦ê¸ˆ5ë°±ë§Œì› í¬í•¨): â‚©43,949,360</b></li>
          <li class="k">ë¬¸ì œ: ì†ŒìŠ¤Â·ì„¸ì²™ ìˆ˜ì‘ì—…, í”¼í¬ ì¸ë ¥</li>
        </ul>
      </div>
      <div class="card">
        <div class="lead">Level B â€” ë¶€ë¶„ ë¬´ì¸</div>
        <ul class="list" style="margin:8px 0 0 18px">
          <li>ë¹„í”¼í¬ ë¬´ì¸ / ìˆœíšŒ ê´€ë¦¬ ë„ì…</li>
          <li>ìŠ¤ë§ˆíŠ¸ í”½ì—… ë½ì»¤, ì •ëŸ‰ ì†ŒìŠ¤ ê°•í™”</li>
          <li id="roadmap_capex_b"><b>ì°½ì—…ì›ê°€(ë³´ì¦ê¸ˆ5ë°±ë§Œì› í¬í•¨): â‚©62,806,388</b></li>
          <li class="k">ë¬¸ì œ: ë½ì»¤ CAPEXÂ·ê³µê°„Â·ì˜¨ë„ ìŠ¤í™ í¸ì°¨</li>
        </ul>
      </div>
      <div class="card">
        <div class="lead">Level A â€” ì˜ì—…ì‹œê°„ ì™„ì „ ë¬´ì¸</div>
        <ul class="list" style="margin:8px 0 0 18px">
          <li>ì˜ì—…ì‹œê°„ ìƒì£¼ 0, ìˆœíšŒ/ì¤‘ì•™ ê´€ë¦¬</li>
          <li>ì½”ë´‡ ë°”ìŠ¤ì¼“ í•¸ë“¤ë§ + ì†ŒìŠ¤ ìë™ í† ìŠ¤</li>
          <li id="roadmap_capex_a"><b>ì°½ì—…ì›ê°€(ë³´ì¦ê¸ˆ5ë°±ë§Œì› í¬í•¨): â‚©124,842,915</b></li>
          <li class="k">ë¬¸ì œ: ì´ˆê¸° CAPEXÂ·ì•ˆì „/ì„¸ì²™ ë³µì¡ì„±</li>
        </ul>
      </div>
    </div>

    <div class="card" style="margin-top:12px">
      <div class="lead">ì „í™˜ ê²Œì´íŠ¸ & ì¶”ê°€ íˆ¬ì</div>
      <table>
        <thead><tr><th>êµ¬ê°„</th><th>ê²Œì´íŠ¸(ê¶Œì¥)</th><th>ì£¼ìš” ì¶”ê°€ì„¤ì¹˜</th><th>ì¶”ê°€ CAPEX(ì í¬)</th></tr></thead>
        <tbody>
          <tr><td>C â†’ B</td><td>ì›”ì£¼ë¬¸ â‰¥ 3,000ê±´, ì•½ì†ì‹œê°„ ìœ„ë°˜ìœ¨ &lt; 5%, ìœ„ìƒÂ·OQS ë¡œê·¸ ë¬´ê²°ì  4ì£¼</td><td>ìŠ¤ë§ˆíŠ¸ ë½ì»¤, ì†ŒìŠ¤ í—¤ë“œ ì¦ì„¤</td><td>â‰ˆ 18,857,028</td></tr>
          <tr><td>B â†’ A</td><td>ì›”ì£¼ë¬¸ â‰¥ 5,000ê±´, 2ë¼ì¸ í•„ìš”, ë°˜í’ˆìœ¨ &lt; 1.5%, ì•ˆì „ ë¬´ê²°ì  8ì£¼</td><td>ì½”ë´‡ ì…€, ìë™ í† ìŠ¤ ì§€ê·¸, ì•ˆì „ ì¸í„°ë½</td><td>â‰ˆ 62,036,527</td></tr>
        </tbody>
      </table>
    </div>
    <div class="note"><b>ì£¼ì„</b> â€” ì•½ì†ì‹œê°„: ë°°ë‹¬ì•± ì¸ë„ ì˜ˆì • ì‹œê° / ë¡œê·¸: ì¥ë¹„Â·ìœ„ìƒ ë°ì´í„° ê¸°ë¡</div>
  </section>

  <!-- ì˜ì‚¬ê²°ì • -->
  <section id="decision" class="sec-slate tint">
    <div class="secbar"></div>
    <h2 class="accentL">â‘© ì„ì› ì˜ì‚¬ê²°ì • ì²´í¬ë¦¬ìŠ¤íŠ¸ <span class="pill">Slate</span></h2>
    <table>
        <thead>
            <tr>
                <th>í•­ëª©</th>
                <th>ìƒì„¸ ë‚´ìš©</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><b>ì´ˆê¸° íˆ¬ì ì˜ˆì‚°(CAPEX) ìŠ¹ì¸</b></td>
                <td class="k">ì‹œë®¬ë ˆì´ì…˜ì—ì„œ ì‚°ì¶œëœ ì´ ì°½ì—… ë¹„ìš©(<span id="decision_capex">â‚©539,168,280</span>, ì˜ˆë¹„ë¹„ 5% í¬í•¨)ì— ëŒ€í•œ ìµœì¢… íˆ¬ì ìŠ¹ì¸ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.</td>
            </tr>
            <tr>
                <td><b>íŒŒì¼ëŸ¿ ë§¤ì¥ ì˜¤í”ˆ ì¼ì •</b></td>
                <td class="k">ë³¸ê²©ì ì¸ í™•ì¥ì— ì•ì„œ, 4ì£¼ê°„ ì‹œí—˜ ìš´ì˜(íŒŒì¼ëŸ¿)ì„ ì§„í–‰í•˜ì—¬ ì‚¬ì—… ëª¨ë¸ì˜ ì‹¤ì œ ìˆ˜ìµì„±ê³¼ ìš´ì˜ ì•ˆì •ì„±ì„ ê²€ì¦í•©ë‹ˆë‹¤.</td>
            </tr>
            <tr>
                <td><b>í•µì‹¬ ì¥ë¹„ ê³µê¸‰ì‚¬(ë²¤ë”) ì„ ì •</b></td>
                <td class="k">ìë™í™” íŠ€ê¹€ê¸°, KDS, ìŠ¤ë§ˆíŠ¸ ë½ì»¤ ë“± í•µì‹¬ ì„¤ë¹„ ê³µê¸‰ì‚¬ì— ê²¬ì ì„ ìš”ì²­(RFQ)í•˜ê³ , ê³µì¥ ì‹¤ì‚¬ë¥¼ í†µí•´ ìµœì¢… ì—…ì²´ë¥¼ ì„ ì •í•©ë‹ˆë‹¤.</td>
            </tr>
            <tr>
                <td><b>ì„¼í„° ìš´ì˜ ë²”ìœ„ ê²°ì •</b></td>
                <td class="k">ì¤‘ì•™ ê´€ì œì„¼í„°ì—ì„œ ìˆ˜í–‰í•  í•µì‹¬ ì—…ë¬´(ì„¸ì²™, ì†ŒìŠ¤ ì œì¡°, ìˆœíšŒ ê´€ë¦¬ ë“±)ë¥¼ ë³¸ì‚¬ì—ì„œ ì§ì ‘ ìš´ì˜í• ì§€, ì „ë¬¸ ì™¸ì£¼ ì—…ì²´ì— ë§¡ê¸¸ì§€ ê²°ì •í•©ë‹ˆë‹¤.</td>
            </tr>
            <tr>
                <td><b>í•µì‹¬ ì„±ê³¼ ì§€í‘œ(KPI) ì„¤ì •</b></td>
                <td class="k">ì‚¬ì—…ì˜ ì„±ê³µì„ ì¸¡ì •í•˜ê¸° ìœ„í•œ í•µì‹¬ ì§€í‘œë¥¼ ì„¤ì •í•©ë‹ˆë‹¤. (ì˜ˆ: ì£¼ë¬¸ ì²˜ë¦¬ ì‹œê°„, ê³ ê° ë§Œì¡±ë„, 100ê±´ ì£¼ë¬¸ë‹¹ íˆ¬ì… ë…¸ë™ ì‹œê°„ ë“±)</td>
            </tr>
             <tr>
                <td><b>ìë™í™” ì „í™˜ ê¸°ì¤€(ê²Œì´íŠ¸) í™•ì •</b></td>
                <td class="k">Cë ˆë²¨ì—ì„œ Bë ˆë²¨ë¡œ, Bë ˆë²¨ì—ì„œ Aë ˆë²¨ë¡œ ì „í™˜í•˜ê¸° ìœ„í•œ êµ¬ì²´ì ì¸ ì¡°ê±´(ì›” ì£¼ë¬¸ëŸ‰, ê³ ê° ë¶ˆë§Œìœ¨ ë“±)ì„ ìµœì¢… í™•ì •í•©ë‹ˆë‹¤.</td>
            </tr>
        </tbody>
    </table>
  </section>

  <div class="tag" style="display:block;text-align:center;margin-top:14px">Â© 2026 ë”±ë§ˆë¦¬ì¹˜í‚¨ â€” ëª¨ë“  ìˆ˜ì¹˜ëŠ” <b>ì¶”ì •</b>ì´ë©° í˜„ì¥ ì¡°ê±´Â·ë²¤ë” ìŠ¤í™ì— ë”°ë¼ ë³€ë™</div>
</div>

<!-- CAPEX Modal -->
<div id="capex_modal" class="modal-backdrop">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="modal_title">Level C ìƒì„¸ CAPEX</h3>
            <button id="modal_close" class="modal-close">&times;</button>
        </div>
        <div class="modal-body" id="modal_body">
            <!-- Dynamic content will be injected here -->
        </div>
    </div>
</div>

<script type="module">
  import { GoogleGenAI, Type } from "https://esm.run/@google/genai";

  // --- API í‚¤ ì„¤ì • ---
  // ì•„ë˜ "ì—¬ê¸°ì—_API_í‚¤ë¥¼_ë¶™ì—¬ë„£ìœ¼ì„¸ìš”" ë¶€ë¶„ì— ìì‹ ì˜ Gemini API í‚¤ë¥¼ ì§ì ‘ ì…ë ¥í•˜ì„¸ìš”.
  const GEMINI_API_KEY = "AIzaSyDDgIyq1naLE9Iv6AV_pYhzVgj6VZZXTiI";
  // --------------------

  // --- CONFIGURATION ---
  const dom = {
    storeSlider: document.getElementById('store_slider'),
    sliderValDisplay: document.getElementById('slider_val_display'),
    aiParamsBtn: document.getElementById('ai_params'),
    applyChangesBtn: document.getElementById('apply_changes'),
    forceLevelButtons: {
      auto: document.getElementById('force_level_auto'),
      c: document.getElementById('force_level_c'),
      b: document.getElementById('force_level_b'),
      a: document.getElementById('force_level_a'),
    },
    // Summary
    summaryStores: document.getElementById('summary_stores'),
    summaryLevel: document.getElementById('summary_level'),
    summaryCapex: document.getElementById('summary_capex'),
    summaryLevelChip: document.getElementById('summary_level_chip'),
    // Conclusion
    conclusionProposal: document.getElementById('conclusion_proposal'),
    conclusionStaff: document.getElementById('conclusion_staff'),
    conclusionStaffNote: document.getElementById('conclusion_staff_note'),
    // Capex
    capexTitle: document.getElementById('capex_title'),
    capexUnit: document.getElementById('capex_unit'),
    capexStoresTotal: document.getElementById('capex_stores_total'),
    capexStoresCalc: document.getElementById('capex_stores_calc'),
    capexHqBase: document.getElementById('capex_hq_base'),
    capexHqDesc: document.getElementById('capex_hq_desc'),
    capexRegionalHubs: document.getElementById('capex_regional_hubs'),
    capexRegionalDesc: document.getElementById('capex_regional_desc'),
    capexPerEmployee: document.getElementById('capex_per_employee'),
    capexEmployeeDesc: document.getElementById('capex_employee_desc'),
    capexSubtotal: document.getElementById('capex_subtotal'),
    capexContingency: document.getElementById('capex_contingency'),
    capexTotal: document.getElementById('capex_total'),
    // OPEX
    opexLaborDesc: document.getElementById('opex_labor_desc'),
    opexLaborCost: document.getElementById('opex_labor_cost'),
    opexRentCost: document.getElementById('opex_rent_cost'),
    opexSaasCost: document.getElementById('opex_saas_cost'),
    opexCenterDesc: document.getElementById('opex_center_desc'),
    opexCenterCost: document.getElementById('opex_center_cost'),
    opexTotal: document.getElementById('opex_total'),
    // P&L Inputs
    pl: {
      aov: document.getElementById('pl_aov'),
      unitsDay: document.getElementById('pl_units_day'),
      rawMeat: document.getElementById('pl_raw_meat'),
      procCost: document.getElementById('pl_proc_cost'),
      pkgCost: document.getElementById('pl_pkg_cost'),
      serviceCost: document.getElementById('pl_service_cost'),
      pf: document.getElementById('pl_pf'),
      rent: document.getElementById('pl_rent'),
      utilRate: document.getElementById('pl_util_rate'),
      saas: document.getElementById('pl_saas'),
      hours: document.getElementById('pl_hours'),
      baseWage: document.getElementById('pl_base_wage'),
      wageMultiplier: document.getElementById('pl_wage_multiplier'),
      calcWage: document.getElementById('pl_calc_wage'),
      days: document.getElementById('pl_days'),
      capex: document.getElementById('pl_capex'),
      threePlRate: document.getElementById('pl_3pl_rate'),
      bSavings: document.getElementById('pl_b_savings'),
      patrolStores: document.getElementById('pl_patrol_stores'),
      patrolWage: document.getElementById('pl_patrol_wage'),
      washingStores: document.getElementById('pl_washing_stores'),
      washingWage: document.getElementById('pl_washing_wage'),
    },
    assumptions: {
      levelTitle: document.getElementById('assumptions_level_title'),
      assumptionsCard: document.getElementById('assumptions_card'),
      bSavingsContainer: document.getElementById('pl_b_savings_container'),
      patrolContainer: document.getElementById('pl_patrol_container'),
      washingContainer: document.getElementById('pl_washing_container'),
      bLevelLabel: document.getElementById('pl_b_level_label'),
      patrolStoresLabel: document.getElementById('pl_patrol_stores_label'),
      patrolWageLabel: document.getElementById('pl_patrol_wage_label'),
      washingStoresLabel: document.getElementById('pl_washing_stores_label'),
      washingWageLabel: document.getElementById('pl_washing_wage_label'),
    },
    // P&L KPI Bar
    pl_kpi: {
      rev: document.getElementById('pl_rev'),
      cogsRatio: document.getElementById('pl_cogs_ratio'),
      var: document.getElementById('pl_var'),
      fix: document.getElementById('pl_fix'),
      ebitda: document.getElementById('pl_ebitda'),
      margin: document.getElementById('pl_margin'),
      bep: document.getElementById('pl_bep'),
      pay: document.getElementById('pl_pay')
    },
    // P&L Table
    pl_t: {
      rev: document.getElementById('pl_t_rev'),
      cogsAbs: document.getElementById('pl_t_cogs_abs'),
      cogsRatio: document.getElementById('pl_t_cogs_ratio'),
      pf: document.getElementById('pl_t_pf'),
      pfDesc: document.getElementById('pl_t_pf_desc'),
      util: document.getElementById('pl_t_util'),
      utilDesc: document.getElementById('pl_t_util_desc'),
      threePl: document.getElementById('pl_t_3pl'),
      threePlDesc: document.getElementById('pl_t_3pl_desc'),
      cm: document.getElementById('pl_t_cm'),
      labor: document.getElementById('pl_t_labor'),
      laborDesc: document.getElementById('pl_t_labor_desc'),
      rent: document.getElementById('pl_t_rent'),
      saas: document.getElementById('pl_t_saas'),
      centerStore: document.getElementById('pl_t_centerStore'),
      centerStoreDesc: document.getElementById('pl_t_centerStore_desc'),
      ebitda: document.getElementById('pl_t_ebitda'),
      margin: document.getElementById('pl_t_margin'),
      bep: document.getElementById('pl_t_bep'),
      payback: document.getElementById('pl_t_payback')
    },
    // Donut
    pl_donut: {
      canvas: document.getElementById('pl_donut'),
      legend: document.getElementById('pl_legend')
    },
    // Total P&L
    total_pnl: {
        rev: document.getElementById('p_rev'),
        cogsRatio: document.getElementById('p_cogs_ratio'),
        var: document.getElementById('p_var'),
        fix: document.getElementById('p_fix'),
        ebitda: document.getElementById('p_ebitda'),
        pay: document.getElementById('p_pay'),
        t_rev: document.getElementById('p_t_rev'),
        t_cogs_abs: document.getElementById('p_t_cogs_abs'),
        t_cogs_ratio: document.getElementById('p_t_cogs_ratio'),
        t_var_etc: document.getElementById('p_t_var_etc'),
        t_cm: document.getElementById('p_t_cm'),
        t_fix_store: document.getElementById('p_t_fix_store'),
        t_center_wage: document.getElementById('p_t_center_wage'),
        t_washing_wage: document.getElementById('p_t_washing_wage'),
        washing_wage_row: document.getElementById('total_pnl_washing_wage_row'),
        t_patrol_wage: document.getElementById('p_t_patrol_wage'),
        patrol_wage_row: document.getElementById('total_pnl_patrol_wage_row'),
        t_ebitda: document.getElementById('p_t_ebitda'),
        t_margin: document.getElementById('p_t_margin'),
        t_payback: document.getElementById('p_t_payback'),
    },
    // HQ P&L
    hq_pnl: {
        marginRate: document.getElementById('hq_margin_rate'),
        t_cogs: document.getElementById('hq_t_cogs'),
        t_revenue: document.getElementById('hq_t_revenue'),
        t_revenue_desc: document.getElementById('hq_t_revenue_desc'),
        t_center_wage: document.getElementById('hq_t_center_wage'),
        t_washing_wage: document.getElementById('hq_t_washing_wage'),
        washing_wage_row: document.getElementById('hq_pnl_washing_wage_row'),
        t_patrol_wage: document.getElementById('hq_t_patrol_wage'),
        patrol_wage_row: document.getElementById('hq_pnl_patrol_wage_row'),
        t_ebitda: document.getElementById('hq_t_ebitda'),
        t_payback: document.getElementById('hq_t_payback'),
    },
    // Scenario Analysis
    scenario: {
        s_rev: document.getElementById('s_rev'),
        s_cogs_ratio: document.getElementById('s_cogs_ratio'),
        s_var: document.getElementById('s_var'),
        s_fix: document.getElementById('s_fix'),
        s_ebitda: document.getElementById('s_ebitda'),
        s_margin: document.getElementById('s_margin'),
        s_pay: document.getElementById('s_pay'),
        f_rev: document.getElementById('f_rev'),
        f_cogs_ratio: document.getElementById('f_cogs_ratio'),
        f_var: document.getElementById('f_var'),
        f_fix: document.getElementById('f_fix'),
        f_ebitda: document.getElementById('f_ebitda'),
        f_margin: document.getElementById('f_margin'),
        f_pay: document.getElementById('f_pay'),
    },
    // Roadmap
    roadmap: {
      capex_c: document.getElementById('roadmap_capex_c'),
      capex_b: document.getElementById('roadmap_capex_b'),
      capex_a: document.getElementById('roadmap_capex_a'),
    },
    // Decision
    decision: {
      capex: document.getElementById('decision_capex'),
    },
    // Modal
    modal: {
        backdrop: document.getElementById('capex_modal'),
        content: document.getElementById('modal_content'),
        title: document.getElementById('modal_title'),
        body: document.getElementById('modal_body'),
        closeBtn: document.getElementById('modal_close'),
    }
  };

  const STORES_PER_REGIONAL_CENTER = 100;
  
  const automationLevels = {
      C: { threshold: 0, name: 'Level C', unitCapex: 43949360, baseFTE: 1.2 },
      B: { threshold: 500, name: 'Level B', unitCapex: 62806388, baseFTE: 1.2 },
      A: { threshold: 1000, name: 'Level A', unitCapex: 124842915, baseFTE: 0.0 }
  };
  
  const capexDetails = {
    C: {
      title: "Level C ìƒì„¸ CAPEX",
      equipment: [
        { item: "ì˜¤í† ë¦¬í”„íŠ¸ íŠ€ê¹€ê¸° 26L Ã— 4", cost: 12760000 },
        { item: "ìë™ ë³¶ìŒê¸°(ì†Œí˜•) Ã— 1", cost: 2050000 },
        { item: "ì „ ìë™í™” ê¸°ê³„ Ã— 3", cost: 4800000 },
        { item: "ì˜¤ì¼ ì •ì œê¸°(22L) Ã— 1", cost: 790000 },
        { item: "ì‹ìš©ìœ  ì‚°íŒ¨ì¸¡ì •ê¸° Ã— 1", cost: 888800 },
        { item: "6ë„ì–´ ëƒ‰ë™(65ë°•ìŠ¤) Ã— 1", cost: 2376000 },
        { item: "4ë„ì–´ ëƒ‰ì¥(45ë°•ìŠ¤) Ã— 1", cost: 1518000 },
        { item: "ì—…ì†Œìš© ì‹ê¸°ì„¸ì²™ê¸°(ë„ì–´í˜•) Ã— 1", cost: 2618360 },
        { item: "ìŠ¤í… ì‘ì—…ëŒ€ 1200(2ë‹¨) Ã— 1", cost: 129000 },
        { item: "ìƒë¶€ ì„ ë°˜ 1200(2ë‹¨) Ã— 1", cost: 105600 },
        { item: "2ë³¼ ì‹±í¬ëŒ€ 1500 Ã— 1", cost: 265000 },
        { item: "ì˜¨ì¥ê³ /ë³´ì˜¨ì¥ Ã— 1", cost: 329000 },
        { item: "ì˜¤ë²„í—¤ë“œ ì›Œë¨¸(í”½ì—… ë³´ì˜¨ ë³´ì¡°) Ã— 1", cost: 232600 },
        { item: "24\" ëª¨ë‹ˆí„°(KDS) Ã— 2", cost: 238000 },
        { item: "ì•ˆë“œë¡œì´ë“œ ë‹¨ë§(4GB/32GB) Ã— 2", cost: 69000 },
        { item: "ë¼ë²¨ í”„ë¦°í„° Ã— 1", cost: 222000 },
        { item: "CCTV 4ch NVR í‚¤íŠ¸ Ã— 1", cost: 189000 },
      ],
      installation: [
        { item: "í›„ë“œÂ·ë•íŠ¸Â·ë°°ê¸°íŒ¬ ì œì‘/ì„¤ì¹˜", cost: 3000000 },
        { item: "ì „ê¸° ë°°ì„ /ì „ìš©íšŒë¡œ(ê²½ë¯¸ ì¦ì„¤ í¬í•¨)", cost: 2200000 },
        { item: "ê°€ìŠ¤Â·ì˜¨ìˆ˜Â·ë°°ìˆ˜ ì—°ê²°/ë°°ê´€", cost: 1700000 },
        { item: "ì£¼ë°© ìë™ì†Œí™”ì¥ì¹˜(í›„ë“œ ì—°ë™)", cost: 1500000 },
        { item: "CCTVÂ·KDS ë„¤íŠ¸ì›Œí¬ ë°°ì„ /ì„¸íŒ…", cost: 500000 },
        { item: "ì¥ë¹„ ë°˜ì…Â·ë ˆë²¨ë§", cost: 400000 },
      ]
    },
    B: {
        title: "Level B ìƒì„¸ CAPEX",
        equipment: [
            { item: "(Level C ì „ ì¥ë¹„ ë™ì¼ í¬í•¨)", cost: 29649360 },
            { item: "ìŠ¤ë§ˆíŠ¸ í”½ì—… ë½ì»¤ 6ì¹¸(íˆíŒ…) Ã— 1", cost: 18238028 },
            { item: "24\" ëª¨ë‹ˆí„°(í”½ì—… ì•ˆë‚´) Ã— 1", cost: 119000 },
        ],
        installation: [
            { item: "(Level C ì„¤ì¹˜ ë™ì¼)", cost: 9300000 },
            { item: "ë½ì»¤ ê³ ì •/ì „ìš©ë°°ì„ /ë¶€ìŠ¤ ë³´ê°•", cost: 500000 },
        ]
    },
    A: {
        title: "Level A ìƒì„¸ CAPEX",
        equipment: [
            { item: "(Level B ì „ ì¥ë¹„ ë™ì¼ í¬í•¨)", cost: 48006388 },
            { item: "í˜‘ë™ë¡œë´‡ 5kgê¸‰(ë³¸ì²´Â·ì»¨íŠ¸ë¡¤ëŸ¬) Ã— 1", cost: 46611450 },
            { item: "ë³‘ìš© ê·¸ë¦¬í¼(2ì§€) Ã— 1", cost: 7533000 },
            { item: "ì½”ë´‡ ìŠ¤íƒ ë“œ/ì›Œí¬ìŠ¤í…Œì´ì…˜ Ã— 1", cost: 2617042 },
            { item: "ì•ˆì „ íœìŠ¤ ëª¨ë“ˆ(ì¶œì… ë„ì–´ í¬í•¨) Ã— 1", cost: 2200000 },
            { item: "ì•ˆì „ ë¦´ë ˆì´ + ë¹„ìƒì •ì§€ ìŠ¤í…Œì´ì…˜(3EA) Ã— 1ì„¸íŠ¸", cost: 575035 },
        ],
        installation: [
            { item: "(Level B ì„¤ì¹˜ ë™ì¼)", cost: 9800000 },
            { item: "ì½”ë´‡ ì…€ ì„¤ì¹˜(ê¸°ì´ˆÂ·ë² ì´ìŠ¤ ê³ ì •Â·í‹°ì¹­/ì‹œìš´ì „)", cost: 2000000 },
            { item: "ì•ˆì „ íœìŠ¤/ì¸í„°ë½ ì‹œê³µ", cost: 500000 },
        ]
    }
  };

  // --- STATE ---
  let state = {
    storeCount: 10,
    currentLevel: 'C',
    forcedLevel: null,
    aiParamsApplied: false,
    beforeAiStaff: null,
    aiParams: {
        cogsDiscountTiers: [
            { threshold: 100, discount: 0.02 },
            { threshold: 500, discount: 0.05 },
            { threshold: 1000, discount: 0.08 }
        ],
        capexDiscountTiers: [
            { threshold: 100, discount: 0.03 },
            { threshold: 500, discount: 0.06 },
            { threshold: 1000, discount: 0.10 }
        ],
        centerStaffSalaries: {
            head: 6000000,
            corporate: 4500000,
            cs: 3500000,
            techSupport: 4000000
        },
        staffing: {
            corporate: 5,
            cs: 1,
            techSupport: 1,
        },
        staffing_reasoning: "",
        capexFactors: {
            hqCapexTiers: [
              { threshold: 0, cost: 50000000 },
              { threshold: 50, cost: 100000000 },
              { threshold: 200, cost: 300000000 }
            ],
            regionalCenterBaseCapex: 30000000,
            perEmployeeCapex: 3000000
        },
        pnlInputs: {
            procCost: 700,
            pkgCost: 1500,
            serviceCost: 2000,
            platformFeeRate: 0.25,
            avgRent: 1000000,
            utilitiesRate: 0.04,
            wageMultiplier: 1.2,
            threePlRate: 0.03,
            automationSavingsRateB: 0.15
        },
        reasoning: {}
    }
  };

  const aiHighlightableInputs = [
    'procCost', 'pkgCost', 'serviceCost', 'pf', 'rent', 'utilRate',
    'wageMultiplier', 'threePlRate', 'bSavings'
  ];

  // --- UTILITIES ---
  function KRW(n, includeSymbol = true) {
    if (isNaN(n) || n === null) return '-';
    const symbol = includeSymbol ? 'â‚©' : '';
    return symbol + Math.round(n).toLocaleString('ko-KR');
  }

  function formatNumber(n) {
      if (isNaN(n) || n === null) return '';
      return n.toLocaleString('ko-KR');
  }

  function parseFormattedNumber(str) {
      if (!str) return 0;
      if (typeof str === 'string' && str.trim() === '---') return 0;
      return Number(String(str).replace(/,/g, ''));
  }

  function gv(elementId, isNumeric = true) {
    const el = dom.pl[elementId] || document.getElementById(elementId);
    if (!el) return isNumeric ? 0 : '';
    return isNumeric ? parseFormattedNumber(el.value) : el.value;
  }

  function clearAiHighlightsAndDefaults() {
      // Clear input highlights
      document.querySelectorAll('.ai-applied').forEach(el => el.classList.remove('ai-applied'));
      // Clear all default value displays
      document.querySelectorAll('.default-value-display').forEach(el => el.remove());
      // Clear all reasoning notes
      document.querySelectorAll('.ai-reasoning-note').forEach(el => el.remove());
      // Clear staff highlight
      const staffEl = dom.conclusionStaff;
      if (staffEl) {
        staffEl.innerHTML = staffEl.innerHTML.replace(/<span class="ai-applied-text">/g, '').replace(/<\/span>/g, '');
      }
  }
  
  function resetAiState() {
      state.aiParamsApplied = false;
      state.beforeAiStaff = null;
      clearAiHighlightsAndDefaults();
  }

  // --- MAPPING & CALCULATION LOGIC ---
  function mapSliderToStoreCount(sliderValue) {
    const val = parseInt(sliderValue, 10);
    if (val <= 100) { // 0-100 -> 10-100 (steps of 10)
        return Math.round((10 + (val / 100) * 90) / 10) * 10;
    } else if (val <= 300) { // 101-300 -> 100-1000 (steps of 50)
        const progress = (val - 100) / 200;
        return Math.round((100 + progress * 900) / 50) * 50;
    } else { // 301-1000 -> 1000-20000 (steps of 100)
        const progress = (val - 300) / 700;
        const logMax = Math.log10(20000);
        const logMin = Math.log10(1000);
        const logValue = logMin + progress * (logMax - logMin);
        const linearValue = Math.pow(10, logValue);
        return Math.round(linearValue / 100) * 100;
    }
  }

  function getAutomationLevel(count) {
    if (state.forcedLevel) {
        return state.forcedLevel;
    }
    if (count >= automationLevels.A.threshold) return 'A';
    if (count >= automationLevels.B.threshold) return 'B';
    return 'C';
  }

  function calculateCogsDiscount(storeCount) {
    if (!state.aiParamsApplied) return 0;
    const tiers = state.aiParams.cogsDiscountTiers;
    let discount = 0;
    for (let i = tiers.length - 1; i >= 0; i--) {
        if (storeCount >= tiers[i].threshold) {
            discount = tiers[i].discount;
            break;
        }
    }
    return discount;
  }
  
  function calculateCapexDiscount(storeCount) {
    if (!state.aiParamsApplied) return 0;
    const tiers = state.aiParams.capexDiscountTiers || [];
    let discount = 0;
    for (let i = tiers.length - 1; i >= 0; i--) {
        if (storeCount >= tiers[i].threshold) {
            discount = tiers[i].discount;
            break;
        }
    }
    return discount;
  }
  
  function getEffectiveUnitCapex(level) {
      const baseCapex = automationLevels[level].unitCapex;
      const discount = calculateCapexDiscount(state.storeCount);
      return baseCapex * (1 - discount);
  }

 function calculateCorporateStaff(storeCount, forceFallback = false) {
    if (!forceFallback && state.aiParamsApplied && state.aiParams.staffing) {
        const support = state.aiParams.staffing.corporate;
        const cs = state.aiParams.staffing.cs;
        return { support, cs, total: support + cs };
    }
    // Fallback logic
    const baseSupport = 5;
    const incrementalSupport = Math.floor(storeCount / 50);
    const support = baseSupport + incrementalSupport;

    let cs = 0;
    if (storeCount <= 100) {
        cs = Math.ceil(storeCount / 10);
    } else if (storeCount <= 500) {
        cs = Math.ceil(100 / 10) + Math.ceil((storeCount - 100) / 20);
    } else {
        cs = Math.ceil(100 / 10) + Math.ceil(400 / 20) + Math.ceil((storeCount - 500) / 30);
    }
    return { support, cs, total: support + cs };
}

function calculateRegionalStaff(storeCount, forceFallback = false) {
    const regionalHubManagers = Math.floor(storeCount / STORES_PER_REGIONAL_CENTER);
    let techSupport;
    if (!forceFallback && state.aiParamsApplied && state.aiParams.staffing) {
        techSupport = state.aiParams.staffing.techSupport;
    } else {
        // Fallback logic
        techSupport = Math.ceil(storeCount / 20);
    }
    return { regionalHubManagers, techSupport, total: regionalHubManagers + techSupport };
}

function calculateAllStaff(storeCount, baseInputs, level, forceFallback = false) {
  const corporate = calculateCorporateStaff(storeCount, forceFallback);
  const regional = calculateRegionalStaff(storeCount, forceFallback);
  const washing = calculateWashingLaborCost(storeCount, baseInputs, level);
  const patrol = calculatePatrolLaborCost(storeCount, baseInputs, level);
  
  const hqDirector = 1;
  const total = hqDirector + corporate.total + regional.total + washing.staffCount + patrol.staffCount;
  
  return {
      hqDirector,
      corporate,
      regional,
      washing,
      patrol,
      total,
      regionalCount: regional.regionalHubManagers
  };
}

  function calculateTotalCentralWages(allStaffData) {
      const salaries = state.aiParams.centerStaffSalaries;
      const directorWage = allStaffData.hqDirector * salaries.head;
      const corporateWages = (allStaffData.corporate.support * salaries.corporate) + (allStaffData.corporate.cs * salaries.cs);
      const regionalWages = (allStaffData.regional.regionalHubManagers * salaries.head) + (allStaffData.regional.techSupport * salaries.techSupport);
      
      return {
          hqWages: directorWage + corporateWages,
          regionalWages: regionalWages,
          total: directorWage + corporateWages + regionalWages
      };
  }
  
  function calculateTotalHqCapex(storeCount, totalStaff) {
      const factors = state.aiParams.capexFactors;
      let hqBase = 0;
      for (let i = factors.hqCapexTiers.length - 1; i >= 0; i--) {
        if (totalStaff >= factors.hqCapexTiers[i].threshold) {
            hqBase = factors.hqCapexTiers[i].cost;
            break;
        }
      }
      
      const regionalCount = Math.floor(storeCount / STORES_PER_REGIONAL_CENTER);
      const regionalTotal = regionalCount * factors.regionalCenterBaseCapex;
      const perEmployeeTotal = totalStaff * factors.perEmployeeCapex;
      
      const total = hqBase + regionalTotal + perEmployeeTotal;
      
      return { total, hqBase, regionalTotal, perEmployeeTotal, regionalCount };
  }
  
 function calculateWashingLaborCost(storeCount, baseInputs, level) {
      if (level !== 'A') return { totalCost: 0, staffCount: 0 };

      const storesPerStaff = baseInputs.assumptions.washingStores > 0 ? baseInputs.assumptions.washingStores : 1;
      const staffCount = Math.ceil(storeCount / storesPerStaff);
      const wageMultiplier = baseInputs.assumptions.washingWage;
      const wage = (baseInputs.fixed.baseWage * baseInputs.fixed.wageMultiplier) * wageMultiplier;
      const monthlyCost = staffCount * wage * baseInputs.fixed.hours * baseInputs.fixed.days;
      
      return { totalCost: monthlyCost, staffCount };
  }

 function calculatePatrolLaborCost(storeCount, baseInputs, level) {
    if (level === 'C') return { totalCost: 0, staffCount: 0 };
    
    const calculatedWage = baseInputs.fixed.baseWage * baseInputs.fixed.wageMultiplier;
    let storesPerStaff, wageMultiplier, staffCount, wage, monthlyCost;
    
    // For Level B, patrol staff is now active.
    if (level === 'B') {
        storesPerStaff = baseInputs.assumptions.patrolStores > 0 ? baseInputs.assumptions.patrolStores : 20;
        wageMultiplier = baseInputs.assumptions.patrolWage;
    } else { // Level A
        storesPerStaff = baseInputs.assumptions.patrolStores > 0 ? baseInputs.assumptions.patrolStores : 8; // Corrected default for A
        wageMultiplier = baseInputs.assumptions.patrolWage;
    }
    
    staffCount = Math.ceil(storeCount / storesPerStaff);
    wage = calculatedWage * wageMultiplier;
    monthlyCost = staffCount * wage * baseInputs.fixed.hours * baseInputs.fixed.days;

    return { totalCost: monthlyCost, staffCount };
  }


  function calcPNL(storeCount, baseInputs) {
    const level = getAutomationLevel(storeCount);
    const levelInfo = automationLevels[level];

    // Inputs
    const { aov, unitsDay, rawMeat, procCost, pkgCost, serviceCost, pf, utilRate, threePlRate } = baseInputs.unit;
    const { hours, baseWage, wageMultiplier, days, rent, saas, capex } = baseInputs.fixed;

    // COGS with discount
    const cogsDiscount = calculateCogsDiscount(storeCount);
    const unitCogsBase = rawMeat + procCost + pkgCost + serviceCost;
    const unitCogs = unitCogsBase * (1 - cogsDiscount);
    
    // Revenue & Variable Costs
    const rev = aov * unitsDay * days;
    const totalCogs = unitCogs * unitsDay * days;
    const platform = rev * pf;
    const utilities = rev * utilRate;
    const threePl = totalCogs * threePlRate;
    const variable = totalCogs + platform + utilities + threePl;

    // Fixed Costs
    const allStaff = calculateAllStaff(storeCount, baseInputs, level);
    const centralWages = calculateTotalCentralWages(allStaff);
    const washingLabor = allStaff.washing.totalCost;
    const patrolLabor = allStaff.patrol.totalCost;
    const totalCenterOpEx = centralWages.total + washingLabor + patrolLabor;
    const centerAlloc = totalCenterOpEx / (storeCount > 0 ? storeCount : 1);

    const calculatedWage = baseWage * wageMultiplier;
    let laborCost;
    let laborDesc;

    const baseLaborCalcString = `${hours}h/ì¼ Ã— ${days}ì¼ Ã— ${KRW(calculatedWage, false)}ì›`;

    if (level === 'A') {
        laborCost = 0;
        laborDesc = `ìë™í™”ë¡œ ì¸ë ¥ 0 (ìˆœíšŒ ì¸ë ¥ìœ¼ë¡œ ëŒ€ì²´)`;
    } else if (level === 'B') {
        const baseFTE = levelInfo.baseFTE;
        const savingsRate = baseInputs.assumptions.bSavings;
        laborCost = hours * calculatedWage * days * baseFTE * (1 - savingsRate);
        laborDesc = `${baseLaborCalcString} Ã— ${baseFTE}ëª… Ã— ìë™í™” ì ˆê° ${(savingsRate * 100).toFixed(1)}%`;
    } else { // Level C
        const baseFTE = levelInfo.baseFTE;
        laborCost = hours * calculatedWage * days * baseFTE;
        laborDesc = `${baseLaborCalcString} Ã— ${baseFTE}ëª…`;
    }
    
    const totalFixed = laborCost + rent + saas + centerAlloc;
    
    // Results
    const ebitda = rev - variable - totalFixed;
    const margin = rev > 0 ? (ebitda / rev) : 0;
    
    const varCostPerUnit = variable / (unitsDay * days);
    const cmPerUnit = aov - varCostPerUnit;
    const bepUnitsTotal = cmPerUnit > 0 ? (totalFixed / cmPerUnit) : NaN;
    const bepDailyUnits = bepUnitsTotal / days;
    
    const payMonths = ebitda > 0 ? (capex / ebitda) : NaN;

    return {
      rev, totalCogs, variable, totalFixed, ebitda, margin, bepDailyUnits, payMonths,
      unitCogs, platform, utilities, threePl, laborCost, rent, saas, centerAlloc,
      calculatedWage, laborDesc, cogsDiscount, allStaff, centralWages, washingLabor, patrolLabor
    };
  }

  function calculateFixed10CScenario() {
      const baseCapex = automationLevels.C.unitCapex; // Fixed scenario has no discount
      const baseInputs = {
          unit: { aov: 22900, unitsDay: 80, rawMeat: 5700, procCost: 700, pkgCost: 1500, serviceCost: 2000, pf: 0.25, utilRate: 0.04, threePlRate: 0.03 },
          fixed: { hours: 13, baseWage: 10030, wageMultiplier: 1.2, days: 30, rent: 1000000, saas: 150000, capex: baseCapex },
          assumptions: { bSavings: 0.15, patrolStores: 20, patrolWage: 1.1, washingStores: 5, washingWage: 1.5 }
      };
      const pnl = calcPNL(10, baseInputs);
      return pnl;
  }
  
  function getCurrentBaseInputs() {
    const level = getAutomationLevel(state.storeCount);
    const effectiveCapex = getEffectiveUnitCapex(level);
    return {
        unit: { aov: gv('aov'), unitsDay: gv('unitsDay'), rawMeat: gv('rawMeat'), procCost: gv('procCost'), pkgCost: gv('pkgCost'), serviceCost: gv('serviceCost'), pf: gv('pf'), utilRate: gv('utilRate'), threePlRate: gv('threePlRate') },
        fixed: { hours: gv('hours'), baseWage: gv('baseWage'), wageMultiplier: gv('wageMultiplier'), days: gv('days'), rent: gv('rent'), saas: gv('saas'), capex: effectiveCapex },
        assumptions: { 
            bSavings: gv('bSavings'), 
            patrolStores: gv('patrolStores'), 
            patrolWage: gv('patrolWage'),
            washingStores: gv('washingStores'),
            washingWage: gv('washingWage')
        }
    };
  }

  // --- UI UPDATE FUNCTIONS ---
  function updateAllUI() {
    const storeCount = state.storeCount;
    const level = getAutomationLevel(storeCount);
    state.currentLevel = level;

    // First, update the state of the assumption inputs UI based on the level
    updateAssumptionsUI(level);

    // Now, get all base inputs from DOM, which will have the correct values
    const baseInputs = getCurrentBaseInputs();
    
    const pnlResults = calcPNL(storeCount, baseInputs);
    const allStaff = pnlResults.allStaff;
    
    updateSummaryUI(storeCount, level);
    updateConclusionUI(storeCount, level, allStaff);
    updateCapexUI(storeCount, level, allStaff);
    updateOpexUI(pnlResults, level);
    updatePnlUI(pnlResults, baseInputs);
    updateTotalPackageResults(storeCount, level, pnlResults);
    updateScenarioAnalysisUI(pnlResults);
    updateDecisionUI();
    updateForceLevelButtons();
  }

  function updateSummaryUI(storeCount, level) {
    const effectiveCapex = getEffectiveUnitCapex(level);
    dom.summaryStores.textContent = formatNumber(storeCount);
    dom.summaryLevel.textContent = automationLevels[level].name;
    dom.summaryCapex.textContent = KRW(effectiveCapex);
    dom.sliderValDisplay.textContent = formatNumber(storeCount);
  }
  
  function updateConclusionUI(storeCount, level, allStaff) {
      dom.conclusionProposal.innerHTML = `${formatNumber(storeCount)}ê°œ <span style="color:var(--sky)">${automationLevels[level].name}</span>`;
      
      let staffText = `ë³¸ì‚¬/ê±°ì  ì´ì›: ${allStaff.total}ëª…`;
      if (state.aiParamsApplied && state.beforeAiStaff && state.beforeAiStaff.total !== allStaff.total) {
        staffText = `ë³¸ì‚¬/ê±°ì  ì´ì›: <span class="ai-applied-text">${allStaff.total}ëª…</span> <span class="default-value-display">(ê¸°ë³¸ê°’: ${state.beforeAiStaff.total}ëª…)</span>`;
      }
      dom.conclusionStaff.innerHTML = staffText;

      let avgPerHub = 0;
      if (allStaff.regionalCount > 0) {
          const hubStaff = allStaff.regional.total + allStaff.patrol.staffCount + allStaff.washing.staffCount;
          avgPerHub = hubStaff / allStaff.regionalCount;
      }
      
      const before = state.beforeAiStaff;
      const aiApplied = state.aiParamsApplied && before;
      
      const supportText = aiApplied && allStaff.corporate.support !== before.corporate.support 
        ? `<span class="ai-applied-text">${allStaff.corporate.support}</span><span class="default-value-display">(${before.corporate.support})</span>` 
        : allStaff.corporate.support;
        
      const csText = aiApplied && allStaff.corporate.cs !== before.corporate.cs 
        ? `<span class="ai-applied-text">${allStaff.corporate.cs}</span><span class="default-value-display">(${before.corporate.cs})</span>` 
        : allStaff.corporate.cs;
        
      const techText = aiApplied && allStaff.regional.techSupport !== before.regional.techSupport 
        ? `<span class="ai-applied-text">${allStaff.regional.techSupport}</span><span class="default-value-display">(${before.regional.techSupport})</span>` 
        : allStaff.regional.techSupport;
      
      let breakdown = `ì´ì› ${allStaff.total}ëª… êµ¬ì„±: ë³¸ì‚¬ ${allStaff.corporate.total + allStaff.hqDirector}ëª…(ì„¼í„°ì¥ ${allStaff.hqDirector}, ì§€ì› ${supportText}, CS ${csText}), ì§€ì ì¥ ${allStaff.regional.regionalHubManagers}ëª…, ê¸°ìˆ ì§€ì› ${techText}ëª…, ì¤‘ì•™ ì„¸ì²™/ì†Œë¶„ ${allStaff.washing.staffCount}ëª… (Aë ˆë²¨), ìˆœíšŒ ê´€ë¦¬ ${allStaff.patrol.staffCount}ëª… (B/Aë ˆë²¨). ${allStaff.regionalCount > 0 ? `ì§€ì—­ ê±°ì ë‹¹ í‰ê·  ${avgPerHub.toFixed(1)}ëª… ë°°ì¹˜.` : ''}`;
      
      let reasoningHtml = '';
      if (state.aiParamsApplied && state.beforeAiStaff && state.beforeAiStaff.total !== allStaff.total && state.aiParams.staffing_reasoning) {
          reasoningHtml = `<br><span class="ai-reasoning-note" style="display:inline;"><b>AI ë¶„ì„:</b> ${state.aiParams.staffing_reasoning}</span>`;
      }

      dom.conclusionStaffNote.innerHTML = `<b>ì£¼ì„</b> â€” ${breakdown.replace(/\s+/g, ' ').trim()}${reasoningHtml}`;
  }


  function updateCapexUI(storeCount, level, allStaff) {
      const effectiveUnitCapex = getEffectiveUnitCapex(level);
      const discount = calculateCapexDiscount(storeCount);
      const hqCapex = calculateTotalHqCapex(storeCount, allStaff.total);
      const factors = state.aiParams.capexFactors;

      const storesTotal = effectiveUnitCapex * storeCount;
      const subtotal = storesTotal + hqCapex.total;
      const contingency = subtotal * 0.05;
      const totalCapex = subtotal + contingency;

      dom.capexTitle.textContent = `â‘¡ ${formatNumber(storeCount)}ê°œ ë§¤ì¥ íŒ¨í‚¤ì§€ ì˜ˆì‚° (CAPEX)`;
      
      let unitCapexText = KRW(effectiveUnitCapex);
      if (discount > 0) { // This check now implicitly depends on aiParamsApplied
          unitCapexText += ` <span class="ai-applied-text" style="font-size: 0.6em;">(${(discount * 100).toFixed(1)}% í• ì¸)</span>`;
      }
      dom.capexUnit.innerHTML = unitCapexText;
      
      dom.capexStoresTotal.textContent = KRW(storesTotal);
      dom.capexStoresCalc.textContent = `${formatNumber(storeCount)} Ã— ${KRW(effectiveUnitCapex, false)}`;
      
      dom.capexHqBase.textContent = KRW(hqCapex.hqBase);
      dom.capexHqDesc.textContent = `(ì´ ${allStaff.total}ëª… ê·œëª¨)`;
      dom.capexRegionalHubs.textContent = KRW(hqCapex.regionalTotal);
      dom.capexRegionalDesc.textContent = `${hqCapex.regionalCount}ê°œ ì§€ì  Ã— ${KRW(factors.regionalCenterBaseCapex, false)}`;
      dom.capexPerEmployee.textContent = KRW(hqCapex.perEmployeeTotal);
      dom.capexEmployeeDesc.textContent = `${allStaff.total}ëª… Ã— ${KRW(factors.perEmployeeCapex, false)}`;
      
      dom.capexSubtotal.textContent = KRW(subtotal);
      dom.capexContingency.textContent = KRW(contingency);
      dom.capexTotal.textContent = KRW(totalCapex);

      dom.pl.capex.value = formatNumber(effectiveUnitCapex);
  }

  function updateOpexUI(pnl, level) {
      dom.opexLaborDesc.textContent = pnl.laborDesc;
      dom.opexLaborCost.textContent = KRW(pnl.laborCost);
      dom.opexRentCost.textContent = KRW(gv('rent'));
      dom.opexSaasCost.textContent = KRW(gv('saas'));
      dom.opexCenterCost.textContent = KRW(pnl.centerAlloc);
      let centerDescText = (level === 'A') ? `CS, ë°°ë‹¬í”Œë«í¼ ê´€ë¦¬, ê¸°ìˆ ì§€ì›, ì„¸ì²™Â·ì‚´ê· Â·ì†Œë¶„` : `CS, ë°°ë‹¬í”Œë«í¼ ê´€ë¦¬, ê¸°ìˆ ì§€ì›`;
      dom.opexCenterDesc.textContent = centerDescText;
      dom.opexTotal.textContent = KRW(pnl.laborCost + gv('rent') + gv('saas') + pnl.centerAlloc);
  }
  
  function updateAssumptionsUI(level) {
      const assumptionsCard = dom.assumptions.assumptionsCard;
      if (level === 'C') {
          assumptionsCard.style.display = 'none';
          return;
      }
      assumptionsCard.style.display = 'block';
      
      dom.assumptions.levelTitle.textContent = `ë¬¼ë¥˜ ë° ${level}ë ˆë²¨ ê°€ì •`;
      const baseWage = gv('baseWage');
      const wageMultiplier = gv('wageMultiplier');
      const calculatedWage = baseWage * wageMultiplier;
      dom.pl.calcWage.value = formatNumber(Math.round(calculatedWage));

      // B-Level Savings
      if (level === 'B') {
          dom.assumptions.bSavingsContainer.style.display = 'block';
          dom.pl.bSavings.disabled = false;
      } else {
          dom.assumptions.bSavingsContainer.style.display = 'none';
          dom.pl.bSavings.disabled = true;
      }

      // Patrol Staff (B & A)
      dom.assumptions.patrolStoresLabel.textContent = `${level}ë ˆë²¨`;
      dom.assumptions.patrolWageLabel.textContent = `${level}ë ˆë²¨`;
      if (level === 'B' || level === 'A') {
          if (dom.pl.patrolStores.value === '---' || dom.pl.patrolStores.disabled) dom.pl.patrolStores.value = (level === 'B' ? '20' : '8');
          dom.pl.patrolStores.disabled = false;
          
          if (dom.pl.patrolWage.value === '---' || dom.pl.patrolWage.disabled) dom.pl.patrolWage.value = (level === 'B' ? '1.1' : '1.2');
          dom.pl.patrolWage.disabled = false;
      } else {
          dom.pl.patrolStores.value = '---';
          dom.pl.patrolStores.disabled = true;
          dom.pl.patrolWage.value = '---';
          dom.pl.patrolWage.disabled = true;
      }

      // Washing Staff (A only)
      dom.assumptions.washingStoresLabel.textContent = `${level}ë ˆë²¨`;
      dom.assumptions.washingWageLabel.textContent = `${level}ë ˆë²¨`;
      if (level === 'A') {
          if (dom.pl.washingStores.value === '---' || dom.pl.washingStores.disabled) dom.pl.washingStores.value = '5';
          dom.pl.washingStores.disabled = false;
          
          if (dom.pl.washingWage.value === '---' || dom.pl.washingWage.disabled) dom.pl.washingWage.value = '1.5';
          dom.pl.washingWage.disabled = false;
      } else {
          dom.pl.washingStores.value = '---';
          dom.pl.washingStores.disabled = true;
          dom.pl.washingWage.value = '---';
          dom.pl.washingWage.disabled = true;
      }
  }


  function updatePnlUI(pnl, inputs) {
    // KPI Bar
    dom.pl_kpi.rev.textContent = KRW(pnl.rev);
    const cogsRatioText = pnl.rev > 0 ? `${(pnl.totalCogs / pnl.rev * 100).toFixed(1)}%` : '-';
    dom.pl_kpi.cogsRatio.textContent = cogsRatioText;
    dom.pl_kpi.var.textContent = KRW(pnl.variable);
    dom.pl_kpi.fix.textContent = KRW(pnl.totalFixed);
    dom.pl_kpi.ebitda.textContent = KRW(pnl.ebitda);
    dom.pl_kpi.margin.textContent = `${(pnl.margin * 100).toFixed(1)}%`;
    dom.pl_kpi.bep.textContent = isNaN(pnl.bepDailyUnits) ? 'N/A' : `${pnl.bepDailyUnits.toFixed(1)} ê±´/ì¼`;
    dom.pl_kpi.pay.textContent = isNaN(pnl.payMonths) ? 'N/A' : `${pnl.payMonths.toFixed(1)} ê°œì›”`;

    // P&L Table
    dom.pl_t.rev.textContent = KRW(pnl.rev);
    dom.pl_t.cogsAbs.textContent = KRW(pnl.totalCogs);
    dom.pl_t.cogsRatio.textContent = `ë§¤ì¶œì˜ ${cogsRatioText}`;
    dom.pl_t.pf.textContent = KRW(pnl.platform);
    dom.pl_t.pfDesc.textContent = `= ë§¤ì¶œ Ã— ${(inputs.unit.pf * 100).toFixed(1)}%`;
    dom.pl_t.util.textContent = KRW(pnl.utilities);
    dom.pl_t.utilDesc.textContent = `ë§¤ì¶œì˜ ${(inputs.unit.utilRate * 100).toFixed(1)}% (ë³€ë™ì„± ë°˜ì˜)`;
    dom.pl_t.threePl.textContent = KRW(pnl.threePl);
    dom.pl_t.threePlDesc.textContent = `ë§¤ì¶œì›ê°€(COGS)ì˜ ${(inputs.unit.threePlRate * 100).toFixed(1)}%`;
    dom.pl_t.cm.textContent = KRW(pnl.rev - pnl.variable);
    dom.pl_t.labor.textContent = KRW(pnl.laborCost);
    dom.pl_t.laborDesc.textContent = pnl.laborDesc;
    dom.pl_t.rent.textContent = KRW(pnl.rent);
    dom.pl_t.saas.textContent = KRW(pnl.saas);
    dom.pl_t.centerStore.textContent = KRW(pnl.centerAlloc);
    dom.pl_t.centerStoreDesc.textContent = dom.opexCenterDesc.textContent;
    dom.pl_t.ebitda.textContent = KRW(pnl.ebitda);
    dom.pl_t.margin.textContent = `ë§ˆì§„ ${(pnl.margin * 100).toFixed(1)}%`;
    dom.pl_t.bep.textContent = isNaN(pnl.bepDailyUnits) ? 'N/A' : `${pnl.bepDailyUnits.toFixed(1)} ê±´/ì¼`;
    dom.pl_t.payback.textContent = isNaN(pnl.payMonths) ? 'N/A' : `${pnl.payMonths.toFixed(1)} ê°œì›”`;

    // Donut Chart
    drawDonut(pnl);
  }
  
  function drawDonut(pnl) {
    const parts = [
      {k:'ë§¤ì¶œì›ê°€', v:pnl.totalCogs, c:'#6366f1'},
      {k:'í”Œë«í¼', v:pnl.platform, c:'#06b6d4'},
      {k:'ì¸ê±´ë¹„', v:pnl.laborCost, c:'#22c55e'},
      {k:'ì„ëŒ€ë£Œ', v:pnl.rent, c:'#f59e0b'},
      {k:'ê³µê³¼ê¸ˆ ë“±', v:pnl.utilities, c:'#eab308'}, 
      {k:'POS/ì¸í„°ë„·', v:pnl.saas, c:'#94a3b8'},
      {k:'ì„¼í„°ì„œë¹„ìŠ¤', v:pnl.centerAlloc, c:'#f97316'},
      {k:'3PL', v:pnl.threePl, c:'#14b8a6'},
      {k:'EBITDA', v:Math.max(pnl.ebitda,0), c:'#3b82f6'}
    ];
    const canvas = dom.pl_donut.canvas; const ctx = canvas.getContext('2d'); ctx.clearRect(0,0,canvas.width,canvas.height);
    const w=canvas.width,h=canvas.height,r=Math.min(w,h)/2 - 6,cx=w/2,cy=h/2; let start=-Math.PI/2; const total=parts.reduce((a,b)=>a+b.v,0);
    if (total === 0 || isNaN(total)) return;
    parts.forEach(p=>{const ang=(p.v/total)*Math.PI*2;ctx.beginPath();ctx.moveTo(cx,cy);ctx.arc(cx,cy,r,start,start+ang);ctx.closePath();ctx.fillStyle=p.c;ctx.fill();start+=ang;});
    ctx.globalCompositeOperation='destination-out';ctx.beginPath();ctx.arc(cx,cy,r*0.60,0,Math.PI*2);ctx.fill();ctx.globalCompositeOperation='source-over';
    ctx.fillStyle='#cbd5e1';ctx.font='bold 14px system-ui';ctx.textAlign='center';ctx.fillText('ë¹„ìš© êµ¬ì¡°(%)',cx,cy-4);ctx.font='12px system-ui';ctx.fillText('ì›” ê¸°ì¤€, 1ì í¬',cx,cy+14);

    const lr = dom.pl_donut.legend; lr.innerHTML='';
    parts.forEach(p=>{
      const l=document.createElement('div');
      const ratio = pnl.rev > 0 ? (p.v / pnl.rev * 100) : 0;
      l.innerHTML=`<span class="dot" style="background:${p.c}"></span> ${p.k} ${isNaN(ratio)?'0.0':ratio.toFixed(1)}%`;
      const rdiv=document.createElement('div'); rdiv.style.textAlign='right'; rdiv.textContent=KRW(p.v);
      lr.appendChild(l); lr.appendChild(rdiv);
    });
  }

  function updateTotalPackageResults(storeCount, level, pnl) {
    const annualMultiplier = 12;
    const totalRev = pnl.rev * storeCount * annualMultiplier;
    const totalCogs = pnl.totalCogs * storeCount * annualMultiplier;
    const totalVar = pnl.variable * storeCount * annualMultiplier;
    const totalStoreFixed = (pnl.laborCost + pnl.rent + pnl.saas) * storeCount * annualMultiplier;

    const centralSupportWages = pnl.centralWages.total * annualMultiplier;
    const washingLabor = pnl.washingLabor * annualMultiplier;
    const patrolLabor = pnl.patrolLabor * annualMultiplier;
    
    // Total EBITDA for the entire package is Revenue minus all costs
    const totalEbitda = totalRev - totalVar - totalStoreFixed - centralSupportWages - washingLabor - patrolLabor;
    
    const hqCapex = calculateTotalHqCapex(storeCount, pnl.allStaff.total);
    const effectiveUnitCapex = getEffectiveUnitCapex(level);
    const storesTotalCapex = effectiveUnitCapex * storeCount;
    const totalCapex = (storesTotalCapex + hqCapex.total) * 1.05;
    
    const paybackYears = totalEbitda > 0 ? (totalCapex / totalEbitda) : NaN;

    // KPI Bar
    dom.total_pnl.rev.textContent = KRW(totalRev);
    dom.total_pnl.cogsRatio.textContent = totalRev > 0 ? `${(totalCogs / totalRev * 100).toFixed(1)}%` : '-';
    dom.total_pnl.var.textContent = KRW(totalVar);
    // Total Fixed cost is store fixed costs + ALL central labor costs
    const totalCentralLabor = centralSupportWages + washingLabor + patrolLabor;
    dom.total_pnl.fix.textContent = KRW(totalStoreFixed + totalCentralLabor);
    dom.total_pnl.ebitda.textContent = KRW(totalEbitda);
    dom.total_pnl.pay.textContent = isNaN(paybackYears) ? 'N/A' : `${paybackYears.toFixed(1)} ë…„`;

    // Table
    dom.total_pnl.t_rev.textContent = KRW(totalRev);
    dom.total_pnl.t_cogs_abs.textContent = KRW(totalCogs);
    dom.total_pnl.t_cogs_ratio.textContent = `ì´ ë§¤ì¶œì˜ ${dom.total_pnl.cogsRatio.textContent}`;
    dom.total_pnl.t_var_etc.textContent = KRW(totalVar - totalCogs);
    dom.total_pnl.t_cm.textContent = KRW(totalRev - totalVar);
    dom.total_pnl.t_fix_store.textContent = KRW(totalStoreFixed);
    
    dom.total_pnl.t_center_wage.textContent = KRW(centralSupportWages);
    
    dom.total_pnl.washing_wage_row.style.display = (level === 'A') ? 'table-row' : 'none';
    dom.total_pnl.t_washing_wage.textContent = KRW(washingLabor);
    
    dom.total_pnl.patrol_wage_row.style.display = (level === 'C') ? 'none' : 'table-row';
    dom.total_pnl.t_patrol_wage.textContent = KRW(patrolLabor);
    
    dom.total_pnl.t_ebitda.textContent = KRW(totalEbitda);
    const totalMargin = totalRev > 0 ? (totalEbitda / totalRev * 100).toFixed(1) : '0.0';
    dom.total_pnl.t_margin.textContent = `ë§ˆì§„ ${totalMargin}%`;
    dom.total_pnl.t_payback.textContent = isNaN(paybackYears) ? 'N/A' : `${paybackYears.toFixed(1)} ë…„`;

    // Update HQ P&L at the same time
    calcHqPnl(level, totalCogs, centralSupportWages, washingLabor, patrolLabor, hqCapex.total);
  }

  function calcHqPnl(level, totalAnnualCogs, centralSupportWages, washingLabor, patrolLabor, centerCapex) {
    const marginRate = parseFormattedNumber(dom.hq_pnl.marginRate.value);
    const hqRevenue = totalAnnualCogs * marginRate;

    // HQ Costs are ONLY central costs, not store costs
    const hqCosts = centralSupportWages + washingLabor + patrolLabor;
    const hqEbitda = hqRevenue - hqCosts;
    const hqPayback = hqEbitda > 0 ? (centerCapex * 1.05 / hqEbitda) : NaN;

    dom.hq_pnl.t_cogs.textContent = KRW(totalAnnualCogs);
    dom.hq_pnl.t_revenue.textContent = KRW(hqRevenue);
    dom.hq_pnl.t_revenue_desc.textContent = `ì´ ê³µê¸‰ê°€ì•¡ Ã— ${(marginRate * 100).toFixed(1)}%`;
    dom.hq_pnl.t_center_wage.textContent = KRW(centralSupportWages);

    dom.hq_pnl.washing_wage_row.style.display = (level === 'A') ? 'table-row' : 'none';
    dom.hq_pnl.t_washing_wage.textContent = KRW(washingLabor);

    dom.hq_pnl.patrol_wage_row.style.display = (level === 'C') ? 'none' : 'table-row';
    dom.hq_pnl.t_patrol_wage.textContent = KRW(patrolLabor);

    dom.hq_pnl.t_ebitda.textContent = KRW(hqEbitda);
    dom.hq_pnl.t_payback.textContent = isNaN(hqPayback) ? 'N/A' : `${hqPayback.toFixed(1)} ë…„`;
  }
  
  function updateScenarioAnalysisUI(currentPnl) {
      const fixedPnl = calculateFixed10CScenario();
      const scenarios = { s: currentPnl, f: fixedPnl };
      for (const [prefix, pnl] of Object.entries(scenarios)) {
          dom.scenario[`${prefix}_rev`].textContent = KRW(pnl.rev);
          dom.scenario[`${prefix}_cogs_ratio`].textContent = pnl.rev > 0 ? `${(pnl.totalCogs / pnl.rev * 100).toFixed(1)}%` : '-';
          dom.scenario[`${prefix}_var`].textContent = KRW(pnl.variable);
          dom.scenario[`${prefix}_fix`].textContent = KRW(pnl.totalFixed);
          dom.scenario[`${prefix}_ebitda`].textContent = KRW(pnl.ebitda);
          dom.scenario[`${prefix}_margin`].textContent = `${(pnl.margin * 100).toFixed(1)}%`;
          dom.scenario[`${prefix}_pay`].textContent = isNaN(pnl.payMonths) ? 'N/A' : `${pnl.payMonths.toFixed(1)} ê°œì›”`;
      }
  }
  
  function updateDecisionUI() {
      dom.decision.capex.textContent = dom.capexTotal.textContent;
  }
  
  function updateForceLevelButtons() {
    Object.values(dom.forceLevelButtons).forEach(btn => btn.classList.remove('active'));
    const level = state.forcedLevel;
    if (level === 'C') dom.forceLevelButtons.c.classList.add('active');
    else if (level === 'B') dom.forceLevelButtons.b.classList.add('active');
    else if (level === 'A') dom.forceLevelButtons.a.classList.add('active');
    else dom.forceLevelButtons.auto.classList.add('active');
  }

  function showCapexModal(level) {
    const details = capexDetails[level];
    if (!details) return;

    dom.modal.title.textContent = details.title;
    
    let html = '<button id="ai_equipment_recommendation_btn" class="btn">ğŸ¤– AI ì¶”ì²œ ì¥ë¹„ ë³´ê¸°</button>';
    html += '<div id="ai_recommendation_results"></div>';
    
    html += '<h4>ì¥ë¹„ ë‚´ì—­</h4><ul>';
    let equipmentTotal = 0;
    details.equipment.forEach(e => {
        html += `<li>${e.item}: ${KRW(e.cost)}</li>`;
        equipmentTotal += e.cost;
    });
    html += `<li class="total-row">ì¥ë¹„ í•©ê³„: ${KRW(equipmentTotal)}</li></ul>`;
    
    html += '<h4>ì„¤ì¹˜/ê³µì‚¬ ë‚´ì—­</h4><ul>';
    let installTotal = 0;
    details.installation.forEach(i => {
        html += `<li>${i.item}: ${KRW(i.cost)}</li>`;
        installTotal += i.cost;
    });
    html += `<li class="total-row">ì„¤ì¹˜ í•©ê³„: ${KRW(installTotal)}</li></ul>`;
    
    const total = equipmentTotal + installTotal;
    const totalWithDeposit = total + 5000000;
    html += `<div class="total-row" style="font-size: 16px; text-align: right; margin-top: 20px;">ì´í•©(ì„¤ì¹˜ í¬í•¨): ${KRW(total)}<br>ë³´ì¦ê¸ˆ í¬í•¨ ì´ˆê¸°íˆ¬ì…: ${KRW(totalWithDeposit)}</div>`;

    dom.modal.body.innerHTML = html;
    dom.modal.backdrop.style.display = 'block';
    
    // Add listener to the newly created button
    document.getElementById('ai_equipment_recommendation_btn').addEventListener('click', () => {
        fetchAiEquipmentRecommendations(level);
    });
  }

  function hideCapexModal() {
      dom.modal.backdrop.style.display = 'none';
  }

  async function fetchAiEquipmentRecommendations(level) {
    const btn = document.getElementById('ai_equipment_recommendation_btn');
    const resultsContainer = document.getElementById('ai_recommendation_results');
    if (!btn || !resultsContainer) return;

    btn.disabled = true;
    btn.textContent = 'ğŸ¤– AIê°€ ì¶”ì²œ ì¥ë¹„ë¥¼ ì°¾ëŠ” ì¤‘...';
    resultsContainer.innerHTML = '<p>AIê°€ ì‹œì¥ ë°ì´í„°ë¥¼ ë¶„ì„í•˜ì—¬ ì¶”ì²œ ì œí’ˆì„ ì°¾ê³  ìˆìŠµë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”...</p>';
    
    const apiKey = GEMINI_API_KEY;
    if (!apiKey || apiKey === "ì—¬ê¸°ì—_API_í‚¤ë¥¼_ë¶™ì—¬ë„£ìœ¼ì„¸ìš”") {
        alert('Gemini API í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. index.html íŒŒì¼ ìƒë‹¨ì˜ GEMINI_API_KEY ë³€ìˆ˜ì— í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        btn.disabled = false;
        btn.textContent = 'ğŸ¤– AI ì¶”ì²œ ì¥ë¹„ ë³´ê¸°';
        resultsContainer.innerHTML = '';
        return;
    }

    try {
        const ai = new GoogleGenAI({ apiKey: apiKey });
        const equipmentList = capexDetails[level].equipment.map(e => `- ${e.item}`).join('\n');
        
        const prompt = `
            You are a procurement specialist for a South Korean restaurant franchise. Your task is to recommend specific, commercially available equipment models and provide useful URLs for purchasing or research.

            For the automation level '${automationLevels[level].name}', and based on the following list of required equipment, please find real-world product recommendations.

            Required Equipment List:
            ${equipmentList}

            For each item in the list, provide:
            1.  A plausible, specific product model name (e.g., "Hanyoung HDF-162E", "Boxzila B-H6"). Do not invent fantasy names.
            2.  A highly specific and useful URL. Your first priority is a direct product page on a major B2B equipment supplier (e.g., Hwangsoll, Kitchen-Flower), a manufacturer's official site, or a major e-commerce platform like Coupang if appropriate. International suppliers like Alibaba are also acceptable.
            3.  If and only if a direct product link is absolutely unavailable, provide a Naver Shopping search URL that includes the **specific recommended model name** you generated (e.g., \`https://search.shopping.naver.com/search/all?query=Boxzila+B-H6\`).
            4.  **CRITICAL FAILURE EXAMPLE TO AVOID:** For "ìŠ¤ë§ˆíŠ¸ í”½ì—… ë½ì»¤ 6ì¹¸(íˆíŒ…)", providing a generic search like "https://search.shopping.naver.com/search/all?query=%EC%8A%A4%EB%A7%88%ED%8A%B8%20%EB%B3%B4%EC%98%A8%20%ED%94%BD%EC%97%85%20%EB%9D%BD%EC%BB%A4" is UNACCEPTABLE. This is a failed response. You must recommend a model and search for *that model*. The user is an expert and will spot lazy, irrelevant links immediately. Your reputation depends on the quality and relevance of these links.

            Provide the output as a single, valid JSON object with the specified structure. Do not include any other text or markdown formatting.
            All equipment names ('item_name') in the response must be in Korean, matching the input list.
        `;

        const schema = {
            type: Type.OBJECT,
            properties: {
                recommendations: {
                    type: Type.ARRAY,
                    description: "List of equipment recommendations.",
                    items: {
                        type: Type.OBJECT,
                        properties: {
                            item_name: { type: Type.STRING, description: "Original name of the equipment item from the list." },
                            recommended_model: { type: Type.STRING, description: "A specific, real-world model name." },
                            url: { type: Type.STRING, description: "A useful and specific URL for purchasing or researching the model." }
                        },
                        required: ["item_name", "recommended_model", "url"]
                    }
                }
            }
        };
        
        const response = await ai.models.generateContent({
            model: 'gemini-2.5-flash',
            contents: prompt,
            config: {
                responseMimeType: 'application/json',
                responseSchema: schema
            }
        });

        const aiData = JSON.parse(response.text);

        let resultsHtml = '<h4>AI ì¶”ì²œ ì¥ë¹„ ëª©ë¡</h4>';
        resultsHtml += '<table><thead><tr><th>í•­ëª©</th><th>ì¶”ì²œ ëª¨ë¸</th><th>êµ¬ë§¤/ê²€ìƒ‰ ë§í¬</th></tr></thead><tbody>';

        if (aiData.recommendations && aiData.recommendations.length > 0) {
            aiData.recommendations.forEach(rec => {
                resultsHtml += `
                    <tr>
                        <td>${rec.item_name}</td>
                        <td>${rec.recommended_model}</td>
                        <td><a href="${rec.url}" target="_blank" rel="noopener noreferrer">ë³´ëŸ¬ê°€ê¸°</a></td>
                    </tr>
                `;
            });
        } else {
            resultsHtml += '<tr><td colspan="3">ì¶”ì²œ ì¥ë¹„ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
        }

        resultsHtml += '</tbody></table>';
        resultsContainer.innerHTML = resultsHtml;

    } catch (error) {
        console.error("AI Equipment Fetch Error:", error);
        resultsContainer.innerHTML = '<p style="color:var(--rose);">ì¥ë¹„ ì¶”ì²œì„ ë°›ì•„ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.</p>';
    } finally {
        btn.disabled = false;
        btn.textContent = 'ğŸ¤– AI ì¶”ì²œ ì¥ë¹„ ë‹¤ì‹œ ë³´ê¸°';
    }
}


  async function fetchAiParameters() {
    dom.aiParamsBtn.disabled = true;
    dom.aiParamsBtn.textContent = 'ğŸ¤– AI íŒŒë¼ë¯¸í„° ì ìš© ì¤‘...';

    // Capture "before" state using fallback logic
    const baseInputsBefore = getCurrentBaseInputs();
    state.beforeAiStaff = calculateAllStaff(state.storeCount, baseInputsBefore, getAutomationLevel(state.storeCount), true); // force fallback

    const apiKey = GEMINI_API_KEY;

    if (!apiKey || apiKey === "ì—¬ê¸°ì—_API_í‚¤ë¥¼_ë¶™ì—¬ë„£ìœ¼ì„¸ìš”") {
        alert('Gemini API í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. index.html íŒŒì¼ ìƒë‹¨ì˜ GEMINI_API_KEY ë³€ìˆ˜ì— í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        dom.aiParamsBtn.disabled = false;
        dom.aiParamsBtn.textContent = 'ğŸ¤– AI ì¶”ì²œ íŒŒë¼ë¯¸í„° ì ìš©';
        return;
    }

    try {
        const ai = new GoogleGenAI({ apiKey: apiKey });
        
        const prompt = `
            You are an expert financial and HR analyst for a specialized South Korean fried chicken franchise.

            Business Model Context:
            - **Store Model**: Small, under 10 pyeong (~33 sqm), delivery-only outlets in low-cost 'C-level' back-alley locations.
            - **Product Process**: A central factory pre-processes chicken (3rd powdering, 1st fry). Stores only perform a final 2nd fry and add sauce/seasoning.
            - **Logistics (3PL)**: Extremely simplified model, similar to a parcel delivery service. The process is: pick up pre-packaged goods (processed chicken, boxes, service items) from the central factory, store them at a warehouse, and perform regular scheduled deliveries to individual stores. There is NO processing, sorting, or complex logistics at the 3PL facility.
            - **Side Menus**: Typical Korean side dishes like tteokbokki or jeon (savory pancakes).
            - **Control Center Roles**: The control center is the operational hub. Its roles evolve with the automation level:
                - **Level C/B**: The focus is on reactive support and supervision. Staff primarily handle remote Customer Service (CS), manage delivery platform listings, and provide remote technical support.
                - **Level A**: The model shifts to proactive, fully unmanned store support. Staff manage centralized washing/prep and remotely oversee opening/closing procedures, in addition to CS and tech support.
            
            **Staffing Analysis Context (for reference at 1,000 stores):**
            - This is the current, potentially inefficient, staffing model for a 1,000-store operation. Your primary task is to analyze this structure and propose a more efficient, optimized staffing model for the requested store count below.
            - **Total**: 82 staff
            - **Breakdown**:
              - **HQ**: 43 total (1 Director, 22 Corporate Support, 20 CS)
              - **Regional**: 5 Hub Managers
              - **Tech Support**: 9 specialists
              - **Patrol Staff**: 25 field staff (for Level B/A)

            Based on a franchise scale of ${state.storeCount} stores and the specific business model above, provide realistic, industry-average estimates for the financial parameters AND **propose an optimized, efficient number of central staff.**
            
            **CRITICAL INSTRUCTION: All text values in the final JSON, especially within the 'staffing_reasoning' and 'reasoning' objects, MUST be written in Korean.** The analysis must be presented in natural, professional Korean, suitable for a business report. For example, in 'staffing_reasoning', explain the logic behind your proposed numbers with specific data: "Aë ˆë²¨ ìë™í™”ë¡œ ë‹¨ìˆœ CS ë¬¸ì˜ê°€ 30% ê°ì†Œí•˜ê³ , ì›ê²© ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œì´ ë„ì…ë˜ì–´ ê¸°ìˆ ì§€ì› ì¸ë ¥ 1ì¸ë‹¹ ê´€ë¦¬ ê°€ëŠ¥ ë§¤ì¥ ìˆ˜ê°€ 50% ì¦ê°€í•˜ë¯€ë¡œ ì¸ë ¥ì„ ì¬ì¡°ì •í–ˆìŠµë‹ˆë‹¤." Avoid generic statements. For 'threePlRate', state "ë‹¨ìˆœ ë³´ê´€/ë°°ì†¡ ëª¨ë¸ì€ ë³µí•© ë¬¼ë¥˜ ëŒ€ë¹„ ê³ ì •ë¹„ê°€ 40% ë‚®ì•„ ë‚®ì€ ë¹„ìœ¨ì„ ì±…ì •í–ˆìŠµë‹ˆë‹¤."

            Provide the output as a single, valid JSON object with the specified structure. Do not include any other text or markdown formatting.
            
            Parameter-specific instructions:
            - **centerStaffSalaries**: Reflect the complex and evolving roles within the control center. Provide appropriate monthly salaries in KRW.
            - **pnlInputs.procCost**: Reflect only the final 2nd fry and saucing process. Reference: one 18-liter can of cooking oil is used for 60 chickens. Factor in oil, sauces, and seasonings. **CRITICAL: The final value MUST NOT exceed 1,500 KRW.**
            - **pnlInputs.serviceCost**: Base this on the average cost of typical Korean side dishes.
            - **pnlInputs.avgRent**: CRITICAL: This must reflect the very low rent of a small (under 10 pyeong / 33sqm), delivery-only store in a non-prime, back-alley 'C-level' commercial area.
            - **pnlInputs.wageMultiplier**: Propose a realistic wage multiplier to apply to the legal minimum wage (10,030 KRW). This should create a competitive market wage. (e.g., 1.1 for 110%, 1.2 for 120%). This value is a multiplier, NOT the final wage.
            - **pnlInputs.threePlRate**: This must be a LOW percentage of COGS, reflecting the highly simplified, parcel-delivery-like logistics model described above.
        `;

        const schema = {
          type: Type.OBJECT,
          properties: {
            cogsDiscountTiers: {
              type: Type.ARRAY,
              description: "Discount tiers based on number of stores.",
              items: {
                type: Type.OBJECT,
                properties: {
                  threshold: { type: Type.NUMBER, description: "Number of stores to trigger discount." },
                  discount: { type: Type.NUMBER, description: "Discount rate as a decimal (e.g., 0.02 for 2%)." }
                },
                required: ["threshold", "discount"]
              }
            },
            capexDiscountTiers: {
              type: Type.ARRAY,
              description: "Equipment CAPEX discount tiers based on number of stores due to purchasing power.",
              items: {
                type: Type.OBJECT,
                properties: {
                  threshold: { type: Type.NUMBER, description: "Number of stores to trigger discount." },
                  discount: { type: Type.NUMBER, description: "Discount rate as a decimal (e.g., 0.02 for 2%)." }
                },
                required: ["threshold", "discount"]
              }
            },
            centerStaffSalaries: {
              type: Type.OBJECT,
              description: "Average monthly salaries in KRW.",
              properties: {
                head: { type: Type.NUMBER, description: "Salary for an HQ Director or Regional Hub Manager." },
                corporate: { type: Type.NUMBER, description: "Salary for a corporate office worker (finance, legal, etc.)." },
                cs: { type: Type.NUMBER, description: "Salary for a Customer Service representative." },
                techSupport: { type: Type.NUMBER, description: "Salary for a technical support/equipment maintenance specialist." }
              },
              required: ["head", "corporate", "cs", "techSupport"]
            },
            staffing: {
              type: Type.OBJECT,
              description: "Optimal number of central staff based on store count and operational complexity.",
              properties: {
                corporate: { type: Type.NUMBER, description: "Number of general corporate/back-office staff (finance, marketing, etc.)." },
                cs: { type: Type.NUMBER, description: "Number of Customer Service representatives." },
                techSupport: { type: Type.NUMBER, description: "Number of technical support specialists for remote diagnostics and field coordination." }
              },
              required: ["corporate", "cs", "techSupport"]
            },
            staffing_reasoning: {
                type: Type.STRING,
                description: "A specific, detailed justification for the proposed staffing numbers, explaining the logic behind the changes compared to the baseline or industry standards. MUST BE IN KOREAN."
            },
            capexFactors: {
              type: Type.OBJECT,
              description: "Factors for calculating central CAPEX.",
              properties: {
                hqCapexTiers: {
                  type: Type.ARRAY,
                  items: {
                    type: Type.OBJECT,
                    properties: {
                      threshold: { type: Type.NUMBER, description: "Total staff count threshold." },
                      cost: { type: Type.NUMBER, description: "Base CAPEX cost for HQ office." }
                    }
                  }
                },
                regionalCenterBaseCapex: { type: Type.NUMBER, description: "Base CAPEX per regional hub." },
                perEmployeeCapex: { type: Type.NUMBER, description: "Additional CAPEX per central employee." }
              },
              required: ["hqCapexTiers", "regionalCenterBaseCapex", "perEmployeeCapex"]
            },
            pnlInputs: {
              type: Type.OBJECT,
              description: "Industry-average values for P&L inputs.",
              properties: {
                procCost: { type: Type.NUMBER, description: "In-store processing cost per unit." },
                pkgCost: { type: Type.NUMBER, description: "Packaging and service menu cost per unit." },
                serviceCost: { type: Type.NUMBER, description: "Side menu cost per unit." },
                platformFeeRate: { type: Type.NUMBER, description: "Average delivery platform fee as a decimal." },
                avgRent: { type: Type.NUMBER, description: "Average monthly rent for a delivery-focused store." },
                utilitiesRate: { type: Type.NUMBER, description: "Utilities and consumables rate as a percentage of revenue." },
                wageMultiplier: { type: Type.NUMBER, description: "Competitive wage multiplier to apply to the base minimum wage." },
                threePlRate: { type: Type.NUMBER, description: "Third-party logistics cost as a percentage of COGS as a decimal." },
                automationSavingsRateB: { type: Type.NUMBER, description: "Labor savings rate for Level B automation as a decimal." }
              },
              required: ["procCost", "pkgCost", "serviceCost", "platformFeeRate", "avgRent", "utilitiesRate", "wageMultiplier", "threePlRate", "automationSavingsRateB"]
            },
            reasoning: {
              type: Type.OBJECT,
              description: "Specific, data-driven justifications for each of the pnlInputs values. MUST BE IN KOREAN.",
              properties: {
                procCost: { type: Type.STRING },
                pkgCost: { type: Type.STRING },
                serviceCost: { type: Type.STRING },
                platformFeeRate: { type: Type.STRING },
                avgRent: { type: Type.STRING },
                utilitiesRate: { type: Type.STRING },
                wageMultiplier: { type: Type.STRING },
                threePlRate: { type: Type.STRING },
                automationSavingsRateB: { type: Type.STRING }
              }
            }
          },
          required: ["cogsDiscountTiers", "capexDiscountTiers", "centerStaffSalaries", "staffing", "staffing_reasoning", "capexFactors", "pnlInputs", "reasoning"]
        };

        const response = await ai.models.generateContent({
          model: 'gemini-2.5-flash',
          contents: prompt,
          config: {
            responseMimeType: 'application/json',
            responseSchema: schema
          }
        });
        
        const aiData = JSON.parse(response.text);
        
        if (aiData.cogsDiscountTiers && aiData.capexDiscountTiers && aiData.centerStaffSalaries && aiData.capexFactors && aiData.pnlInputs && aiData.staffing && aiData.staffing_reasoning && aiData.reasoning) {
            clearAiHighlightsAndDefaults();
            
            const originalValues = {};
            aiHighlightableInputs.forEach(key => {
                if (dom.pl[key]) {
                    originalValues[key] = dom.pl[key].value;
                }
            });

            // Add a hard cap on procCost
            if (aiData.pnlInputs.procCost > 1500) {
                aiData.pnlInputs.procCost = 1500;
            }

            state.aiParams = aiData;
            state.aiParamsApplied = true;
            
            // Apply P&L inputs to the UI and add highlight class
            const pnl = aiData.pnlInputs;
            dom.pl.procCost.value = formatNumber(pnl.procCost);
            dom.pl.pkgCost.value = formatNumber(pnl.pkgCost);
            dom.pl.serviceCost.value = formatNumber(pnl.serviceCost);
            dom.pl.pf.value = pnl.platformFeeRate;
            dom.pl.rent.value = formatNumber(pnl.avgRent);
            dom.pl.utilRate.value = pnl.utilitiesRate;
            dom.pl.wageMultiplier.value = pnl.wageMultiplier;
            dom.pl.threePlRate.value = pnl.threePlRate;
            dom.pl.bSavings.value = pnl.automationSavingsRateB;
            
            const dynamicReasoningMap = aiData.reasoning;

            aiHighlightableInputs.forEach(key => {
                if(dom.pl[key]) {
                    const inputEl = dom.pl[key];
                    const labelEl = inputEl.parentElement;
                    if (!labelEl || labelEl.tagName !== 'LABEL') return;

                    inputEl.classList.add('ai-applied');
                    
                    // Add default value display
                    const displaySpan = document.createElement('span');
                    displaySpan.className = 'default-value-display';
                    displaySpan.textContent = `(ê¸°ë³¸ê°’: ${originalValues[key]})`;
                    labelEl.appendChild(displaySpan);

                    // Add reasoning note
                    if (dynamicReasoningMap[key]) {
                        const reasoningDiv = document.createElement('div');
                        reasoningDiv.className = 'ai-reasoning-note';
                        reasoningDiv.textContent = dynamicReasoningMap[key];
                        labelEl.appendChild(reasoningDiv);
                    }
                }
            });

            alert('AI ì¶”ì²œ íŒŒë¼ë¯¸í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.');
            updateAllUI();
        } else {
            throw new Error("Invalid or incomplete data structure from AI.");
        }

    } catch (error) {
        console.error("AI Parameter Fetch Error:", error);
        alert('AI íŒŒë¼ë¯¸í„° ì ìš© ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. API í‚¤ê°€ ì˜¬ë°”ë¥¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.');
        state.beforeAiStaff = null; // Clear before-state on error
    } finally {
        dom.aiParamsBtn.disabled = false;
        dom.aiParamsBtn.textContent = 'ğŸ¤– AI ì¶”ì²œ íŒŒë¼ë¯¸í„° ì ìš©';
    }
  }


  // --- EVENT LISTENERS ---
  function setupEventListeners() {
    dom.storeSlider.addEventListener('input', (e) => {
      state.forcedLevel = null; // Revert to auto mode when slider is used
      resetAiState();
      const storeCount = mapSliderToStoreCount(e.target.value);
      if (storeCount !== state.storeCount) {
        state.storeCount = storeCount;
        updateAllUI();
      }
    });

    dom.applyChangesBtn.addEventListener('click', updateAllUI);
    dom.aiParamsBtn.addEventListener('click', fetchAiParameters);
    
    Object.entries(dom.forceLevelButtons).forEach(([key, btn]) => {
        btn.addEventListener('click', () => {
            state.forcedLevel = key === 'auto' ? null : key.toUpperCase();
            updateAllUI();
        });
    });


    // Add formatting to all numeric inputs on blur
    const numericInputs = document.querySelectorAll('input[type="text"]');
    numericInputs.forEach(input => {
        if (!input.readOnly) {
           input.addEventListener('blur', (e) => {
              const val = parseFormattedNumber(e.target.value);
              if (!isNaN(val) && e.target.id !== 'pl_pf' && e.target.id !== 'pl_util_rate' && e.target.id !== 'pl_3pl_rate' && e.target.id !== 'pl_b_savings' && e.target.id !== 'pl_patrol_wage' && e.target.id !== 'pl_washing_wage' && e.target.id !== 'hq_margin_rate' && e.target.id !== 'pl_wage_multiplier' ) {
                 e.target.value = formatNumber(val);
              }
           });
        }
    });

    dom.summaryLevelChip.addEventListener('click', () => {
        showCapexModal(state.currentLevel);
    });
    dom.modal.closeBtn.addEventListener('click', hideCapexModal);
    dom.modal.backdrop.addEventListener('click', (e) => {
        if (e.target === dom.modal.backdrop) {
            hideCapexModal();
        }
    });
  }

  // --- INITIALIZATION ---
  window.addEventListener('load', () => {
    // Format initial numbers
    const allInputs = document.querySelectorAll('input[type="text"]');
    allInputs.forEach(input => {
        if (!input.readOnly) {
           const val = parseFormattedNumber(input.value);
            if (!isNaN(val) && input.id !== 'pl_pf' && input.id !== 'pl_util_rate' && input.id !== 'pl_3pl_rate' && input.id !== 'pl_b_savings' && input.id !== 'pl_patrol_wage' && input.id !== 'pl_washing_wage' && input.id !== 'hq_margin_rate' && input.id !== 'pl_wage_multiplier' ) {
             input.value = formatNumber(val);
            }
        }
    });

    setupEventListeners();
    updateAllUI();
  });
</script>
<script type="module" src="/index.tsx"></script>
</body>
</html>